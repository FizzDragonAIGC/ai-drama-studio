<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FizzDragon AI Drama Studio v3</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        *{margin:0;padding:0;box-sizing:border-box}
        :root{
            --bg:#0a0a0c;--surface:#111114;--surface2:#1a1a1f;
            --border:#2a2a32;--text:#f0f0f2;--dim:#888890;
            --primary:#ff6b35;--primary-dark:#e55a2b;
            --success:#22c55e;--cyan:#06b6d4;--pink:#ec4899;--purple:#a855f7;
            --warning:#eab308;--error:#ef4444;
            --radius:10px;--radius-sm:6px;
        }
        body{font-family:'Inter',system-ui,sans-serif;background:var(--bg);color:var(--text);min-height:100vh;line-height:1.6}
        
        /* Layout */
        .app{display:flex;flex-direction:column;min-height:100vh}
        .header{padding:16px 24px;background:var(--surface);border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between}
        .logo{font-size:20px;font-weight:700;background:linear-gradient(135deg,var(--primary),var(--pink));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
        .header-info{display:flex;gap:16px;align-items:center}
        .badge{padding:4px 12px;background:var(--surface2);border-radius:20px;font-size:11px;color:var(--dim)}
        .badge.active{background:var(--primary);color:#fff}
        
        .main{flex:1;display:grid;grid-template-columns:300px 1fr 350px;gap:0}
        
        /* Left Panel - Progress */
        .panel-left{background:var(--surface);border-right:1px solid var(--border);padding:20px;overflow-y:auto}
        .panel-left h2{font-size:12px;color:var(--dim);text-transform:uppercase;letter-spacing:1px;margin-bottom:16px}
        
        .step-list{list-style:none}
        .step-item{display:flex;align-items:center;gap:12px;padding:12px;border-radius:var(--radius-sm);margin-bottom:8px;cursor:pointer;transition:all .2s}
        .step-item:hover{background:var(--surface2)}
        .step-item.active{background:var(--primary);color:#fff}
        .step-item.done{opacity:.7}
        .step-num{width:28px;height:28px;border-radius:50%;background:var(--surface2);display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:600}
        .step-item.active .step-num{background:rgba(255,255,255,.2)}
        .step-item.done .step-num{background:var(--success);color:#fff}
        .step-item.done .step-num::after{content:'âœ“'}
        .step-info{flex:1}
        .step-title{font-size:13px;font-weight:500}
        .step-desc{font-size:11px;color:var(--dim)}
        .step-item.active .step-desc{color:rgba(255,255,255,.7)}
        
        /* Center - Content */
        .panel-center{padding:24px;overflow-y:auto}
        
        .content-card{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:24px;margin-bottom:20px}
        .content-card h3{font-size:16px;margin-bottom:16px;display:flex;align-items:center;gap:8px}
        .content-card h3 .icon{font-size:20px}
        
        .form-group{margin-bottom:20px}
        .form-label{display:block;font-size:12px;color:var(--dim);margin-bottom:8px}
        .form-input{width:100%;padding:12px;background:var(--surface2);border:1px solid var(--border);border-radius:var(--radius-sm);color:var(--text);font-size:14px}
        .form-input:focus{outline:none;border-color:var(--primary)}
        textarea.form-input{min-height:200px;resize:vertical;font-family:inherit}
        
        .btn{padding:12px 24px;background:var(--surface2);border:1px solid var(--border);color:var(--text);border-radius:var(--radius);cursor:pointer;font-size:13px;font-weight:500;transition:all .2s}
        .btn:hover{border-color:var(--primary);background:rgba(255,107,53,.1)}
        .btn-primary{background:var(--primary);border-color:var(--primary);color:#fff}
        .btn-primary:hover{background:var(--primary-dark)}
        .btn-group{display:flex;gap:10px;margin-top:20px}
        
        /* Report Sections */
        .report{background:var(--surface2);border-radius:var(--radius);padding:20px;margin:16px 0}
        .report h4{font-size:13px;color:var(--primary);margin-bottom:12px}
        .report-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:12px}
        .stat-box{background:var(--bg);padding:16px;border-radius:var(--radius-sm);text-align:center}
        .stat-val{font-size:24px;font-weight:700;color:var(--primary)}
        .stat-label{font-size:11px;color:var(--dim);margin-top:4px}
        
        .item-card{background:var(--bg);border:1px solid var(--border);border-radius:var(--radius-sm);padding:16px;margin:12px 0}
        .item-card h5{font-size:14px;margin-bottom:8px;display:flex;align-items:center;gap:8px}
        .item-card p{font-size:13px;color:var(--dim);margin:4px 0}
        .tag{display:inline-block;padding:2px 8px;background:var(--surface);border-radius:12px;font-size:10px;color:var(--cyan);margin:2px}
        
        /* Right Panel - Output */
        .panel-right{background:var(--surface);border-left:1px solid var(--border);padding:20px;overflow-y:auto}
        .panel-right h2{font-size:12px;color:var(--dim);text-transform:uppercase;letter-spacing:1px;margin-bottom:16px}
        
        .output-section{margin-bottom:24px}
        .output-file{display:flex;align-items:center;gap:10px;padding:10px;background:var(--surface2);border-radius:var(--radius-sm);margin-bottom:8px;font-size:12px}
        .output-file .icon{color:var(--cyan)}
        .output-file .name{flex:1}
        .output-file .size{color:var(--dim)}
        
        .export-btn{width:100%;padding:14px;background:var(--surface2);border:1px solid var(--border);color:var(--text);border-radius:var(--radius);cursor:pointer;font-size:13px;margin-bottom:8px;display:flex;align-items:center;justify-content:center;gap:8px}
        .export-btn:hover{border-color:var(--success);color:var(--success)}
        
        /* Storyboard Table */
        .storyboard-table{width:100%;border-collapse:collapse;font-size:12px}
        .storyboard-table th,.storyboard-table td{padding:12px;text-align:left;border-bottom:1px solid var(--border)}
        .storyboard-table th{background:var(--surface2);color:var(--dim);font-weight:500}
        .storyboard-table tr:hover{background:var(--surface2)}
        .shot-id{color:var(--primary);font-weight:600}
        .shot-type{padding:2px 8px;border-radius:10px;font-size:10px}
        .shot-type.narrative{background:rgba(34,197,94,.2);color:var(--success)}
        .shot-type.dramatic{background:rgba(255,107,53,.2);color:var(--primary)}
        .shot-type.emotional{background:rgba(236,72,153,.2);color:var(--pink)}
        
        /* Subject Card */
        .subject-card{background:var(--bg);border:1px solid var(--border);border-radius:var(--radius-sm);padding:12px;margin:8px 0}
        .subject-header{display:flex;align-items:center;gap:8px;margin-bottom:8px}
        .subject-type{padding:2px 8px;border-radius:10px;font-size:10px;font-weight:500}
        .subject-type.person{background:rgba(6,182,212,.2);color:var(--cyan)}
        .subject-type.animal{background:rgba(168,85,247,.2);color:var(--purple)}
        .subject-type.crowd{background:rgba(234,179,8,.2);color:var(--warning)}
        .subject-name{font-weight:600}
        .subject-detail{font-size:11px;color:var(--dim);margin:4px 0}
        .subject-detail strong{color:var(--text)}
        .dialogue-box{background:var(--surface);padding:10px;border-radius:var(--radius-sm);margin-top:8px;border-left:3px solid var(--cyan)}
        .dialogue-box .speaker{font-size:10px;color:var(--cyan);margin-bottom:4px}
        .dialogue-box .line{font-style:italic}
        
        /* Scene Card */
        .scene-card{background:var(--bg);border:1px solid var(--border);border-radius:var(--radius-sm);padding:12px;margin:8px 0}
        .scene-header{font-weight:600;margin-bottom:8px}
        .scene-detail{display:grid;grid-template-columns:1fr 1fr;gap:8px;font-size:11px}
        .scene-detail span{padding:6px 10px;background:var(--surface);border-radius:var(--radius-sm)}
        .scene-detail .label{color:var(--dim)}
        .scene-detail .value{color:var(--text)}
        
        /* Prompt Box */
        .prompt-box{background:#1e1e24;border:1px solid var(--border);border-radius:var(--radius-sm);padding:12px;margin:8px 0;font-family:'Fira Code',monospace;font-size:11px;color:var(--cyan);word-break:break-all}
        .prompt-label{font-size:10px;color:var(--dim);margin-bottom:6px;display:flex;align-items:center;gap:6px}
        
        /* Tabs */
        .tabs{display:flex;border-bottom:1px solid var(--border);margin-bottom:20px}
        .tab{padding:12px 20px;font-size:13px;color:var(--dim);cursor:pointer;border-bottom:2px solid transparent;transition:all .2s}
        .tab:hover{color:var(--text)}
        .tab.active{color:var(--primary);border-bottom-color:var(--primary)}
        
        /* Progress Bar */
        .progress-wrap{margin-bottom:24px}
        .progress-bar{height:8px;background:var(--surface2);border-radius:4px;overflow:hidden}
        .progress-fill{height:100%;background:linear-gradient(90deg,var(--primary),var(--pink));transition:width .5s}
        .progress-text{font-size:11px;color:var(--dim);margin-top:8px;text-align:center}
        
        /* Loading */
        .loading{display:flex;align-items:center;justify-content:center;gap:12px;padding:40px;color:var(--dim)}
        .spinner{width:24px;height:24px;border:3px solid var(--surface2);border-top-color:var(--primary);border-radius:50%;animation:spin 1s linear infinite}
        @keyframes spin{to{transform:rotate(360deg)}}
        
        /* Responsive */
        @media(max-width:1200px){.main{grid-template-columns:1fr}.panel-left,.panel-right{display:none}}
    </style>
</head>
<body>
<div class="app">
    <header class="header">
        <div class="logo">ğŸ‰ FizzDragon AI Drama Studio v3</div>
        <div class="header-info">
            <span class="badge" id="novelStats">ç­‰å¾…å°å…¥</span>
            <span class="badge active">249 Skills</span>
            <span class="badge">30 Agents</span>
        </div>
    </header>
    
    <main class="main">
        <!-- Left Panel: Steps -->
        <aside class="panel-left">
            <h2>ğŸ“‹ è£½ä½œæµç¨‹</h2>
            <ul class="step-list" id="stepList"></ul>
            
            <div style="margin-top:24px;padding-top:16px;border-top:1px solid var(--border)">
                <h2>ğŸ“Š ç•¶å‰é€²åº¦</h2>
                <div class="progress-wrap">
                    <div class="progress-bar"><div class="progress-fill" id="progressFill" style="width:0%"></div></div>
                    <div class="progress-text" id="progressText">0% - æº–å‚™é–‹å§‹</div>
                </div>
            </div>
        </aside>
        
        <!-- Center: Content -->
        <section class="panel-center" id="contentArea">
            <!-- Dynamic content will be inserted here -->
        </section>
        
        <!-- Right Panel: Output -->
        <aside class="panel-right">
            <h2>ğŸ“ è¼¸å‡ºæ–‡æª”</h2>
            <div id="outputFiles"></div>
            
            <div style="margin-top:24px;padding-top:16px;border-top:1px solid var(--border)">
                <h2>ğŸ“¤ å°å‡º</h2>
                <button class="export-btn" onclick="exportJSON()">ğŸ“„ å°å‡ºJSON</button>
                <button class="export-btn" onclick="exportCSV()">ğŸ“Š å°å‡ºCSV</button>
                <button class="export-btn" onclick="exportPrompts()">ğŸ–¼ï¸ å°å‡ºPrompts</button>
            </div>
        </aside>
    </main>
</div>

<script>
// ==================== ç³»çµ±é…ç½® ====================
const STEPS = [
    {id:1, name:'å°å…¥å°èªª', desc:'ä¸Šå‚³æˆ–è²¼å…¥10è¬å­—å°èªª', icon:'ğŸ“–'},
    {id:2, name:'é«˜æ¦‚å¿µ', desc:'ç”ŸæˆLoglineå’Œé¡å‹å®šä½', icon:'ğŸ’¡'},
    {id:3, name:'ç« ç¯€æ‹†åˆ†', desc:'æ™ºèƒ½åˆ†æç« ç¯€çµæ§‹', icon:'ğŸ“‘'},
    {id:4, name:'è§’è‰²è¨­è¨ˆ', desc:'ä¸»è§’+é…è§’+ç¾¤æ¼”', icon:'ğŸ‘¥'},
    {id:5, name:'æœåŒ–é“', desc:'æœè£ã€åŒ–å¦ã€é“å…·', icon:'ğŸ‘”'},
    {id:6, name:'ç« ç¯€åŠ‡æœ¬', desc:'é€ç« æ’°å¯«åˆ†å ´åŠ‡æœ¬', icon:'âœï¸'},
    {id:7, name:'åˆ†é¡è¨­è¨ˆ', desc:'å ´æ™¯+ä¸»é«”+Prompt', icon:'ğŸ¬'},
    {id:8, name:'å®Œæˆè¼¸å‡º', desc:'å°å‡ºå…¨éƒ¨è£½ä½œè³‡æ–™', icon:'ğŸ‰'}
];

// ä¸»é«”é¡å‹
const SUBJECT_TYPES = {
    person: {label:'äººç‰©', color:'cyan', icon:'ğŸ‘¤'},
    animal: {label:'å‹•ç‰©', color:'purple', icon:'ğŸ¾'},
    crowd: {label:'ç¾¤æ¼”', color:'warning', icon:'ğŸ‘¥'},
    object: {label:'ç‰©é«”', color:'dim', icon:'ğŸ“¦'},
    none: {label:'ç©ºé¡', color:'dim', icon:'ğŸï¸'}
};

// ç‹€æ…‹
let state = {
    currentStep: 1,
    novel: {
        text: '',
        title: '',
        wordCount: 0
    },
    concept: {
        logline: '',
        genre: '',
        theme: '',
        audience: ''
    },
    chapters: [],
    characters: {
        main: [],      // ä¸»è§’
        supporting: [], // é…è§’
        extras: []      // ç¾¤æ¼”
    },
    costumes: {},
    scripts: [],
    storyboard: []
};

// ==================== åˆå§‹åŒ– ====================
function init(){
    renderSteps();
    showStep(1);
    updateProgress();
}

function renderSteps(){
    const html = STEPS.map(s => `
        <li class="step-item ${s.id === state.currentStep ? 'active' : ''} ${s.id < state.currentStep ? 'done' : ''}" 
            onclick="goToStep(${s.id})">
            <div class="step-num">${s.id < state.currentStep ? '' : s.id}</div>
            <div class="step-info">
                <div class="step-title">${s.icon} ${s.name}</div>
                <div class="step-desc">${s.desc}</div>
            </div>
        </li>
    `).join('');
    document.getElementById('stepList').innerHTML = html;
}

function updateProgress(){
    const pct = Math.round(((state.currentStep - 1) / (STEPS.length - 1)) * 100);
    document.getElementById('progressFill').style.width = pct + '%';
    document.getElementById('progressText').textContent = `${pct}% - ${STEPS[state.currentStep-1]?.name || ''}`;
}

function goToStep(step){
    if(step <= state.currentStep){
        state.currentStep = step;
        renderSteps();
        showStep(step);
        updateProgress();
    }
}

function nextStep(){
    if(state.currentStep < STEPS.length){
        state.currentStep++;
        renderSteps();
        showStep(state.currentStep);
        updateProgress();
    }
}

// ==================== æ­¥é©Ÿå…§å®¹ ====================
function showStep(step){
    const content = document.getElementById('contentArea');
    
    switch(step){
        case 1: content.innerHTML = renderStep1(); break;
        case 2: content.innerHTML = renderStep2(); break;
        case 3: content.innerHTML = renderStep3(); break;
        case 4: content.innerHTML = renderStep4(); break;
        case 5: content.innerHTML = renderStep5(); break;
        case 6: content.innerHTML = renderStep6(); break;
        case 7: content.innerHTML = renderStep7(); break;
        case 8: content.innerHTML = renderStep8(); break;
    }
    
    updateOutputPanel();
}

// ==================== Step 1: å°å…¥å°èªª ====================
function renderStep1(){
    return `
        <div class="content-card">
            <h3><span class="icon">ğŸ“–</span> å°å…¥æˆ–å‰µä½œå°èªª</h3>
            
            <!-- é¸é …å¡ -->
            <div class="tabs" style="margin-bottom:20px">
                <div class="tab active" onclick="showInputMode('upload')">ğŸ“ ä¸Šå‚³æ–‡æª”</div>
                <div class="tab" onclick="showInputMode('paste')">ğŸ“ è²¼å…¥æ–‡å­—</div>
                <div class="tab" onclick="showInputMode('generate')">âœ¨ AIå¯«å°èªª</div>
            </div>
            
            <div id="inputModeContent">
                ${renderUploadMode()}
            </div>
        </div>
    `;
}

function showInputMode(mode){
    document.querySelectorAll('.tabs .tab').forEach(t => t.classList.remove('active'));
    event.target.classList.add('active');
    
    const content = document.getElementById('inputModeContent');
    switch(mode){
        case 'upload': content.innerHTML = renderUploadMode(); break;
        case 'paste': content.innerHTML = renderPasteMode(); break;
        case 'generate': content.innerHTML = renderGenerateMode(); break;
    }
}

function renderUploadMode(){
    return `
        <p style="color:var(--dim);margin-bottom:20px">æ”¯æŒ <strong>TXTã€Word (.docx)ã€PDF</strong> æ ¼å¼ï¼Œæœ€å¤§æ”¯æŒ10è¬å­—+</p>
        
        <div class="form-group">
            <label class="form-label">å°èªªæ¨™é¡Œï¼ˆå¯é¸ï¼Œæœƒè‡ªå‹•å¾æ–‡æª”æå–ï¼‰</label>
            <input type="text" class="form-input" id="novelTitle" placeholder="ä¾‹ï¼šæµ·ä¸Šçµ²ç¶¢ä¹‹è·¯å¯†ç¢¼" value="${state.novel.title}">
        </div>
        
        <div style="border:2px dashed var(--border);border-radius:12px;padding:40px;text-align:center;margin:20px 0;cursor:pointer" 
             onclick="document.getElementById('fileInput').click()"
             ondragover="event.preventDefault();this.style.borderColor='var(--primary)'"
             ondragleave="this.style.borderColor='var(--border)'"
             ondrop="handleFileDrop(event)">
            <div style="font-size:48px;margin-bottom:16px">ğŸ“„</div>
            <p style="font-size:16px;margin-bottom:8px">æ‹–æ”¾æ–‡ä»¶åˆ°é€™è£¡</p>
            <p style="color:var(--dim);font-size:13px">æˆ–é»æ“Šé¸æ“‡æ–‡ä»¶</p>
            <p style="color:var(--cyan);font-size:12px;margin-top:12px">æ”¯æŒ .txt .docx .pdf</p>
        </div>
        
        <input type="file" id="fileInput" accept=".txt,.docx,.pdf" style="display:none" onchange="handleFileUpload(event)">
        
        <div id="uploadStatus" style="margin:16px 0"></div>
        
        <div class="btn-group">
            <button class="btn" onclick="loadDemoNovel()">ğŸ“š è¼‰å…¥ç¤ºä¾‹</button>
            <button class="btn btn-primary" onclick="analyzeNovel()" id="analyzeBtn" disabled>é–‹å§‹åˆ†æ â†’</button>
        </div>
    `;
}

function renderPasteMode(){
    setTimeout(() => {
        const textarea = document.getElementById('novelText');
        if(textarea){
            textarea.addEventListener('input', updateWordCount);
            updateWordCount();
        }
    }, 100);
    
    return `
        <p style="color:var(--dim);margin-bottom:20px">ç›´æ¥è²¼å…¥å°èªªå…¨æ–‡</p>
        
        <div class="form-group">
            <label class="form-label">å°èªªæ¨™é¡Œ</label>
            <input type="text" class="form-input" id="novelTitle" placeholder="ä¾‹ï¼šæµ·ä¸Šçµ²ç¶¢ä¹‹è·¯å¯†ç¢¼" value="${state.novel.title || ''}">
        </div>
        
        <div class="form-group">
            <label class="form-label">å°èªªæ­£æ–‡</label>
            <textarea class="form-input" id="novelText" style="min-height:350px" placeholder="å°‡å°èªªå…¨æ–‡è²¼å…¥æ­¤è™•..." oninput="updateWordCount()">${state.novel.text || ''}</textarea>
        </div>
        
        <div style="display:flex;justify-content:space-between;align-items:center;margin:16px 0">
            <span id="wordCount" style="color:var(--dim);font-size:13px">${state.novel.text ? state.novel.text.length + ' å­—' : '0 å­—'}</span>
        </div>
        
        <div class="btn-group">
            <button class="btn" onclick="loadDemoNovelPaste()">ğŸ“š è¼‰å…¥ç¤ºä¾‹</button>
            <button class="btn btn-primary" onclick="analyzeNovelFromPaste()">é–‹å§‹åˆ†æ â†’</button>
        </div>
    `;
}

function updateWordCount(){
    const textarea = document.getElementById('novelText');
    const countSpan = document.getElementById('wordCount');
    if(textarea && countSpan){
        const count = textarea.value.length;
        countSpan.textContent = count.toLocaleString() + ' å­—';
        countSpan.style.color = count > 1000 ? 'var(--success)' : 'var(--dim)';
    }
}

function loadDemoNovelPaste(){
    const titleInput = document.getElementById('novelTitle');
    const textArea = document.getElementById('novelText');
    
    if(titleInput) titleInput.value = 'æµ·ä¸Šçµ²ç¶¢ä¹‹è·¯å¯†ç¢¼';
    if(textArea) textArea.value = DEMO_NOVEL;
    
    updateWordCount();
}

function renderGenerateMode(){
    return `
        <p style="color:var(--dim);margin-bottom:20px">å‘Šè¨´AIä½ æƒ³è¦ä»€éº¼æ¨£çš„æ•…äº‹ï¼ŒAIæœƒç‚ºä½ å‰µä½œå°èªª</p>
        
        <div class="form-group">
            <label class="form-label">æ•…äº‹é¡å‹</label>
            <select class="form-input" id="storyGenre">
                <option value="æ­·å²å†’éšª">ğŸ›ï¸ æ­·å²å†’éšª</option>
                <option value="ä»™ä¿ ">âš”ï¸ ä»™ä¿ </option>
                <option value="éƒ½å¸‚è¨€æƒ…">ğŸ’• éƒ½å¸‚è¨€æƒ…</option>
                <option value="æ‡¸ç–‘æ¨ç†">ğŸ” æ‡¸ç–‘æ¨ç†</option>
                <option value="ç§‘å¹»">ğŸš€ ç§‘å¹»</option>
                <option value="å¥‡å¹»">ğŸ‰ å¥‡å¹»</option>
                <option value="ææ€–">ğŸ‘» ææ€–</option>
                <option value="è·å ´">ğŸ’¼ è·å ´</option>
            </select>
        </div>
        
        <div class="form-group">
            <label class="form-label">æ•…äº‹è¨­å®š / ä½ çš„æƒ³æ³•</label>
            <textarea class="form-input" id="storyIdea" style="min-height:150px" placeholder="ä¾‹å¦‚ï¼š&#10;- å”ä»£å»£å·ï¼Œä¸€å€‹å°å·å¶ç„¶å¾—åˆ°ç¥ç§˜å¯¶çŸ³&#10;- è¢«è¿«æ²å…¥æµ·ä¸Šçµ²ç¶¢ä¹‹è·¯çš„å†’éšª&#10;- é‡åˆ°ç¥ç§˜å°‘å¥³ï¼Œè§£é–‹åƒå¹´è©›å’’ä¹‹è¬&#10;- æƒ³è¦æœ‰æµ·ç›œã€å¯†å®¤æ®ºäººã€è¼ªè¿´å…ƒç´ "></textarea>
        </div>
        
        <div class="form-group">
            <label class="form-label">ç›®æ¨™ç¯‡å¹…</label>
            <select class="form-input" id="storyLength">
                <option value="çŸ­ç¯‡">çŸ­ç¯‡ï¼ˆ1-2è¬å­—ï¼‰</option>
                <option value="ä¸­ç¯‡" selected>ä¸­ç¯‡ï¼ˆ5-10è¬å­—ï¼‰</option>
                <option value="é•·ç¯‡">é•·ç¯‡ï¼ˆ20è¬å­—+ï¼‰</option>
            </select>
        </div>
        
        <div class="form-group">
            <label class="form-label">åƒè€ƒä½œå“é¢¨æ ¼ï¼ˆå¯é¸ï¼‰</label>
            <input type="text" class="form-input" id="storyReference" placeholder="ä¾‹ï¼šåŠ å‹’æ¯”æµ·ç›œ + é•·å®‰åäºŒæ™‚è¾°">
        </div>
        
        <div id="generateStatus" style="margin:16px 0"></div>
        
        <div class="btn-group">
            <button class="btn btn-primary" onclick="generateNovel()">âœ¨ é–‹å§‹å‰µä½œå°èªª</button>
        </div>
    `;
}

function handleFileUpload(event){
    const file = event.target.files[0];
    if(file){
        processFile(file);
    }
}

function handleFileDrop(event){
    event.preventDefault();
    event.target.style.borderColor = 'var(--border)';
    const file = event.dataTransfer.files[0];
    if(file){
        processFile(file);
    }
}

function processFile(file){
    const statusDiv = document.getElementById('uploadStatus');
    const analyzeBtn = document.getElementById('analyzeBtn');
    const ext = file.name.split('.').pop().toLowerCase();
    
    statusDiv.innerHTML = `<div class="loading"><div class="spinner"></div>æ­£åœ¨è®€å– ${file.name}...</div>`;
    
    if(ext === 'txt'){
        // TXT ç›´æ¥è®€å–
        const reader = new FileReader();
        reader.onload = function(e){
            const text = e.target.result;
            state.novel.text = text;
            state.novel.title = document.getElementById('novelTitle').value || file.name.replace('.txt','');
            showUploadSuccess(file.name, text.length);
        };
        reader.readAsText(file);
    } 
    else if(ext === 'docx'){
        // DOCX ä½¿ç”¨ mammoth.jsï¼ˆéœ€è¦è¼‰å…¥åº«ï¼‰
        const reader = new FileReader();
        reader.onload = function(e){
            // ç°¡åŒ–è™•ç†ï¼šæç¤ºç”¨æˆ¶DOCXæ”¯æŒ
            statusDiv.innerHTML = `
                <div style="padding:16px;background:var(--surface2);border-radius:8px">
                    <p style="color:var(--warning)">âš ï¸ Wordæ–‡æª”è§£æä¸­...</p>
                    <p style="color:var(--dim);font-size:12px;margin-top:8px">
                        å¦‚é‡å•é¡Œï¼Œå»ºè­°å°‡Wordå¦å­˜ç‚ºTXTæ ¼å¼å¾Œé‡æ–°ä¸Šå‚³
                    </p>
                </div>
            `;
            // æ¨¡æ“¬DOCXè§£æï¼ˆå¯¦éš›éœ€è¦mammoth.jsï¼‰
            setTimeout(() => {
                // å‡è¨­æˆåŠŸè®€å–
                state.novel.text = "[Wordæ–‡æª”å…§å®¹]\n\nè«‹å°‡Wordæ–‡æª”å¦å­˜ç‚ºTXTæ ¼å¼ï¼Œæˆ–ç›´æ¥è²¼å…¥æ–‡å­—å…§å®¹ã€‚";
                state.novel.title = file.name.replace('.docx','');
                showUploadSuccess(file.name, 1000);
            }, 1500);
        };
        reader.readAsArrayBuffer(file);
    }
    else if(ext === 'pdf'){
        // PDF æç¤º
        statusDiv.innerHTML = `
            <div style="padding:16px;background:var(--surface2);border-radius:8px">
                <p style="color:var(--warning)">âš ï¸ PDFæ–‡æª”è§£æä¸­...</p>
                <p style="color:var(--dim);font-size:12px;margin-top:8px">
                    PDFè§£æå¯èƒ½ä¸å®Œæ•´ï¼Œå»ºè­°ä½¿ç”¨TXTæˆ–Wordæ ¼å¼
                </p>
            </div>
        `;
        setTimeout(() => {
            state.novel.text = "[PDFæ–‡æª”å…§å®¹]\n\nè«‹å°‡PDFæ–‡æª”è¤‡è£½æ–‡å­—å¾Œè²¼å…¥ï¼Œæˆ–å¦å­˜ç‚ºTXTæ ¼å¼ã€‚";
            state.novel.title = file.name.replace('.pdf','');
            showUploadSuccess(file.name, 1000);
        }, 1500);
    }
    else {
        statusDiv.innerHTML = `<p style="color:var(--error)">âŒ ä¸æ”¯æŒçš„æ–‡ä»¶æ ¼å¼ï¼š${ext}</p>`;
    }
}

function showUploadSuccess(filename, wordCount){
    const statusDiv = document.getElementById('uploadStatus');
    const analyzeBtn = document.getElementById('analyzeBtn');
    
    statusDiv.innerHTML = `
        <div style="padding:16px;background:rgba(34,197,94,.1);border:1px solid rgba(34,197,94,.3);border-radius:8px">
            <p style="color:var(--success)">âœ… æ–‡ä»¶è®€å–æˆåŠŸï¼</p>
            <p style="margin-top:8px">
                <span style="color:var(--dim)">æ–‡ä»¶åï¼š</span>${filename}<br>
                <span style="color:var(--dim)">å­—æ•¸ï¼š</span><strong style="color:var(--primary)">${wordCount.toLocaleString()}</strong> å­—
            </p>
        </div>
    `;
    analyzeBtn.disabled = false;
}

function analyzeNovelFromPaste(){
    const titleEl = document.getElementById('novelTitle');
    const textEl = document.getElementById('novelText');
    
    const title = titleEl ? titleEl.value.trim() : '';
    const text = textEl ? textEl.value.trim() : '';
    
    console.log('analyzeNovelFromPaste:', {title, textLength: text.length});
    
    if(!text || text.length < 100){
        alert('è«‹è¼¸å…¥å°èªªæ­£æ–‡ï¼ˆè‡³å°‘100å­—ï¼‰');
        return;
    }
    
    state.novel = {
        title: title || 'æœªå‘½åå°èªª',
        text: text,
        wordCount: text.length
    };
    
    document.getElementById('novelStats').textContent = `${state.novel.title} | ${(text.length/10000).toFixed(1)}è¬å­—`;
    nextStep();
}

function generateNovel(){
    const genreEl = document.getElementById('storyGenre');
    const ideaEl = document.getElementById('storyIdea');
    const lengthEl = document.getElementById('storyLength');
    const refEl = document.getElementById('storyReference');
    
    const genre = genreEl ? genreEl.value : 'æ­·å²å†’éšª';
    const idea = ideaEl ? ideaEl.value.trim() : '';
    const length = lengthEl ? lengthEl.value : 'ä¸­ç¯‡';
    const reference = refEl ? refEl.value.trim() : '';
    
    console.log('generateNovel:', {genre, idea, length, reference});
    
    if(!idea){
        alert('è«‹è¼¸å…¥ä½ çš„æ•…äº‹æƒ³æ³•');
        return;
    }
    
    const statusDiv = document.getElementById('generateStatus');
    if(!statusDiv){
        console.error('generateStatus not found');
        return;
    }
    
    statusDiv.innerHTML = `
        <div class="loading">
            <div class="spinner"></div>
            <span>AIæ­£åœ¨å‰µä½œå°èªª...</span>
        </div>
        <div style="margin-top:16px;padding:16px;background:var(--surface2);border-radius:8px">
            <p style="font-size:12px;color:var(--dim)">ğŸ¤– å‰µä½œé€²åº¦ï¼š</p>
            <p style="margin-top:8px;font-size:13px" id="genProgress">æ­£åœ¨æ§‹æ€æ•…äº‹æ¡†æ¶...</p>
        </div>
    `;
    
    // æ¨¡æ“¬ç”Ÿæˆéç¨‹
    const steps = [
        'æ­£åœ¨æ§‹æ€æ•…äº‹æ¡†æ¶...',
        'è¨­è¨ˆä¸»è¦è§’è‰²...',
        'è¦åŠƒç« ç¯€å¤§ç¶±...',
        'æ’°å¯«ç¬¬ä¸€ç« ...',
        'æ’°å¯«ç¬¬äºŒç« ...',
        'æ’°å¯«ç¬¬ä¸‰ç« ...',
        'å®Œå–„ç´°ç¯€æå¯«...',
        'ç”Ÿæˆå®Œæˆï¼'
    ];
    
    let stepIndex = 0;
    const interval = setInterval(() => {
        stepIndex++;
        if(stepIndex < steps.length){
            document.getElementById('genProgress').textContent = steps[stepIndex];
        } else {
            clearInterval(interval);
            
            // ç”Ÿæˆç¤ºä¾‹å°èªª
            const generatedNovel = generateSampleNovel(genre, idea, reference);
            state.novel = {
                title: generatedNovel.title,
                text: generatedNovel.content,
                wordCount: generatedNovel.content.length
            };
            
            document.getElementById('novelStats').textContent = `${state.novel.title} | ${(state.novel.wordCount/10000).toFixed(1)}è¬å­—`;
            
            statusDiv.innerHTML = `
                <div style="padding:16px;background:rgba(34,197,94,.1);border:1px solid rgba(34,197,94,.3);border-radius:8px">
                    <p style="color:var(--success)">âœ… å°èªªå‰µä½œå®Œæˆï¼</p>
                    <p style="margin-top:8px">
                        <span style="color:var(--dim)">æ¨™é¡Œï¼š</span><strong>${generatedNovel.title}</strong><br>
                        <span style="color:var(--dim)">é¡å‹ï¼š</span>${genre}<br>
                        <span style="color:var(--dim)">å­—æ•¸ï¼š</span><strong style="color:var(--primary)">${state.novel.wordCount.toLocaleString()}</strong> å­—
                    </p>
                </div>
                <div class="btn-group" style="margin-top:16px">
                    <button class="btn" onclick="previewNovel()">ğŸ‘ï¸ é è¦½å°èªª</button>
                    <button class="btn btn-primary" onclick="nextStep()">ç¹¼çºŒè£½ä½œ â†’</button>
                </div>
            `;
        }
    }, 800);
}

function generateSampleNovel(genre, idea, reference){
    // æ ¹æ“šç”¨æˆ¶è¼¸å…¥ç”Ÿæˆç¤ºä¾‹å°èªª
    let title = 'æ–°å‰µä½œçš„æ•…äº‹';
    let content = '';
    
    if(idea.includes('å”') || idea.includes('çµ²ç¶¢') || genre === 'æ­·å²å†’éšª'){
        title = 'æµ·ä¸Šçµ²ç¶¢ä¹‹è·¯å¯†ç¢¼';
        content = DEMO_NOVEL;
    } else if(genre === 'ä»™ä¿ '){
        title = 'åŠèµ·è’¼ç©¹';
        content = `ã€ŠåŠèµ·è’¼ç©¹ã€‹

ã€ç¬¬ä¸€ç«  å»¢æŸ´å°‘å¹´ã€‘
é’é›²å±±ï¼ŒéˆåŠæ´¾ã€‚
æ—è»’ç«™åœ¨æ‡¸å´–é‚Šï¼Œçœ‹è‘—è…³ä¸‹ç¿»æ¹§çš„é›²æµ·ï¼Œå¿ƒä¸­æ»¿æ˜¯è‹¦æ¾€ã€‚
åå…­æ­²äº†ï¼Œé‚„æ˜¯ç…‰æ°£ä¸€å±¤ï¼Œé€£æœ€åŸºç¤çš„å¼•æ°£å…¥é«”éƒ½åšä¸åˆ°ã€‚
ã€Œå»¢ç‰©å°±æ˜¯å»¢ç‰©ã€‚ã€èº«å¾Œå‚³ä¾†å˜²è«·çš„è²éŸ³...

ã€ç¬¬äºŒç«  æ„å¤–æ©Ÿç·£ã€‘
æ·±å¤œï¼Œæ—è»’ç¨è‡ªåœ¨è—ç¶“é–£æ‰“æƒã€‚
ä¸€æœ¬ç ´èˆŠçš„å¤ç±å¾æ›¸æ¶é ‚ç«¯æ»‘è½ï¼Œç ¸åœ¨ä»–é ­ä¸Šã€‚
ã€Œé€™æ˜¯...å¤ªä¸Šé•·ç”Ÿè¨£ï¼Ÿã€...

ã€ç¬¬ä¸‰ç«  åˆéœ²é‹’èŠ’ã€‘
ä¸‰å€‹æœˆå¾Œï¼Œå®—é–€å¤§æ¯”ã€‚
æ²’æœ‰äººæ³¨æ„åˆ°è§’è½è£¡é‚£å€‹æ›¾ç¶“çš„å»¢ç‰©ï¼Œçœ¼ä¸­é–ƒçˆè‘—è‡ªä¿¡çš„å…‰èŠ’...`;
    } else {
        title = 'æœªå‘½åæ•…äº‹';
        content = `ã€Š${title}ã€‹

åŸºæ–¼ä½ çš„å‰µæ„ï¼š
${idea}

é¡å‹ï¼š${genre}
${reference ? 'åƒè€ƒé¢¨æ ¼ï¼š' + reference : ''}

ã€ç¬¬ä¸€ç« ã€‘
æ•…äº‹é–‹å§‹...

ï¼ˆé€™æ˜¯ä¸€å€‹ç”±AIæ ¹æ“šä½ çš„å‰µæ„ç”Ÿæˆçš„æ•…äº‹æ¡†æ¶ã€‚åœ¨å¯¦éš›æ‡‰ç”¨ä¸­ï¼ŒAIæœƒæ ¹æ“šä½ çš„æè¿°å‰µä½œå®Œæ•´çš„å°èªªå…§å®¹ã€‚ï¼‰`;
    }
    
    return { title, content };
}

function previewNovel(){
    alert('å°èªªé è¦½ï¼š\n\n' + state.novel.text.slice(0, 500) + '...');
}

// ==================== é‡æ–°ç”Ÿæˆå‡½æ•¸ ====================
function regenerateConcept(){
    const content = document.getElementById('contentArea');
    content.innerHTML = `
        <div class="content-card">
            <div class="loading">
                <div class="spinner"></div>
                <span>é‡æ–°ç”Ÿæˆé«˜æ¦‚å¿µ...</span>
            </div>
        </div>
    `;
    
    setTimeout(() => {
        state.concept = generateConcept();
        showStep(2);
    }, 1500);
}

function regenerateStoryboard(){
    const content = document.getElementById('contentArea');
    content.innerHTML = `
        <div class="content-card">
            <div class="loading">
                <div class="spinner"></div>
                <span>é‡æ–°ç”Ÿæˆåˆ†é¡...</span>
            </div>
        </div>
    `;
    
    setTimeout(() => {
        state.storyboard = generateStoryboard();
        showStep(7);
    }, 2000);
}

function resplitChapters(){
    const content = document.getElementById('contentArea');
    content.innerHTML = `
        <div class="content-card">
            <div class="loading">
                <div class="spinner"></div>
                <span>é‡æ–°æ‹†åˆ†ç« ç¯€...</span>
            </div>
        </div>
    `;
    
    setTimeout(() => {
        state.chapters = splitChapters();
        showStep(3);
    }, 1500);
}

function reextractCharacters(){
    const content = document.getElementById('contentArea');
    content.innerHTML = `
        <div class="content-card">
            <div class="loading">
                <div class="spinner"></div>
                <span>é‡æ–°åˆ†æè§’è‰²...</span>
            </div>
        </div>
    `;
    
    setTimeout(() => {
        state.characters = extractCharacters();
        showStep(4);
    }, 1500);
}

function loadDemoNovel(){
    const titleInput = document.getElementById('novelTitle');
    const textArea = document.getElementById('novelText');
    
    if(titleInput) titleInput.value = 'æµ·ä¸Šçµ²ç¶¢ä¹‹è·¯å¯†ç¢¼';
    if(textArea) textArea.value = DEMO_NOVEL;
    
    // å¦‚æœæ˜¯ä¸Šå‚³æ¨¡å¼ï¼Œä¹Ÿæ›´æ–°ç‹€æ…‹
    state.novel.title = 'æµ·ä¸Šçµ²ç¶¢ä¹‹è·¯å¯†ç¢¼';
    state.novel.text = DEMO_NOVEL;
    state.novel.wordCount = DEMO_NOVEL.length;
    
    const statusDiv = document.getElementById('uploadStatus');
    const analyzeBtn = document.getElementById('analyzeBtn');
    
    if(statusDiv){
        statusDiv.innerHTML = `
            <div style="padding:16px;background:rgba(34,197,94,.1);border:1px solid rgba(34,197,94,.3);border-radius:8px">
                <p style="color:var(--success)">âœ… ç¤ºä¾‹å°èªªå·²è¼‰å…¥ï¼</p>
                <p style="margin-top:8px">
                    <span style="color:var(--dim)">æ¨™é¡Œï¼š</span>æµ·ä¸Šçµ²ç¶¢ä¹‹è·¯å¯†ç¢¼<br>
                    <span style="color:var(--dim)">å­—æ•¸ï¼š</span><strong style="color:var(--primary)">${DEMO_NOVEL.length.toLocaleString()}</strong> å­—
                </p>
            </div>
        `;
    }
    if(analyzeBtn) analyzeBtn.disabled = false;
}

function analyzeNovel(){
    // å¾ä¸Šå‚³æ¨¡å¼åˆ†æ
    const title = document.getElementById('novelTitle')?.value.trim() || state.novel.title;
    const text = state.novel.text;
    
    if(!text){
        alert('è«‹å…ˆä¸Šå‚³æˆ–è¼‰å…¥å°èªª');
        return;
    }
    
    state.novel = {
        title: title || 'æœªå‘½åå°èªª',
        text: text,
        wordCount: text.length
    };
    
    document.getElementById('novelStats').textContent = `${state.novel.title} | ${(text.length/10000).toFixed(1)}è¬å­—`;
    
    nextStep();
}

// ==================== Step 2: é«˜æ¦‚å¿µ ====================
function renderStep2(){
    const concept = generateConcept();
    state.concept = concept;
    
    return `
        <div class="content-card">
            <h3><span class="icon">ğŸ’¡</span> é«˜æ¦‚å¿µåˆ†æ</h3>
            <p style="color:var(--dim);margin-bottom:20px">åŸºæ–¼å°èªªå…§å®¹è‡ªå‹•ç”Ÿæˆæ•…äº‹å®šä½ã€‚</p>
            
            <div class="report">
                <h4>ğŸ¯ Loglineï¼ˆä¸€å¥è©±æ¦‚æ‹¬ï¼‰</h4>
                <p style="font-size:16px;color:var(--primary);padding:16px;background:var(--bg);border-radius:8px;font-style:italic;line-height:1.8">
                    "${concept.logline}"
                </p>
            </div>
            
            <div class="report">
                <h4>ğŸ“Š æ•…äº‹å®šä½</h4>
                <div class="report-grid">
                    <div class="stat-box"><div class="stat-label">é¡å‹</div><div class="stat-val" style="font-size:14px">${concept.genre}</div></div>
                    <div class="stat-box"><div class="stat-label">ä¸»é¡Œ</div><div class="stat-val" style="font-size:14px">${concept.theme}</div></div>
                    <div class="stat-box"><div class="stat-label">å—çœ¾</div><div class="stat-val" style="font-size:14px">${concept.audience}</div></div>
                    <div class="stat-box"><div class="stat-label">æ™‚ä»£</div><div class="stat-val" style="font-size:14px">${concept.era}</div></div>
                </div>
            </div>
            
            <div class="report">
                <h4>ğŸ£ æ ¸å¿ƒè³£é»</h4>
                <ul style="color:var(--dim);font-size:14px;padding-left:20px">
                    ${concept.hooks.map(h => `<li style="margin:8px 0">${h}</li>`).join('')}
                </ul>
            </div>
            
            <div class="btn-group">
                <button class="btn" onclick="regenerateConcept()">ğŸ”„ é‡æ–°ç”Ÿæˆ</button>
                <button class="btn btn-primary" onclick="nextStep()">ç¢ºèª â†’ ç« ç¯€æ‹†åˆ†</button>
            </div>
        </div>
    `;
}

function generateConcept(){
    const text = state.novel.text;
    const title = state.novel.title;
    
    // ç°¡å–®åˆ†æï¼ˆå¯¦éš›æ‡‰ç”¨ä¸­é€™è£¡æœƒèª¿ç”¨AIï¼‰
    let concept = {
        logline: '',
        genre: 'æ­·å²å†’éšª',
        theme: 'æˆé•·èˆ‡å‘½é‹',
        audience: '18-35æ­²',
        era: 'å”ä»£',
        hooks: []
    };
    
    if(title.includes('çµ²ç¶¢ä¹‹è·¯') || text.includes('å”') || text.includes('è•ƒåŠ')){
        concept.logline = 'å”ä»£å»£å·ï¼Œä¸€å€‹13æ­²çš„è¡—é ­ç¥å·æ„å¤–æ²å…¥è·¨è¶Šå—æ´‹çš„å°‹å¯¶å†’éšªã€‚åœ¨æµ·ä¸Šå¯†å®¤æ®ºäººæ¡ˆèˆ‡åƒå¹´è¼ªè¿´è©›å’’çš„é›™é‡è¬åœ˜ä¸­ï¼Œä»–å¿…é ˆè§£é–‹ç²‰ç´…å¯¶çŸ³çš„ç§˜å¯†â€”â€”å¦å‰‡æ‰€æœ‰äººéƒ½å°‡è‘¬èº«å¤§æµ·ã€‚';
        concept.genre = 'æ­·å²å†’éšª / æ‡¸ç–‘';
        concept.theme = 'èº«ä»½èªåŒ Ã— å‘½é‹æŠ—çˆ­';
        concept.era = 'å”ä»£ï¼ˆæµ·ä¸Šçµ²è·¯ï¼‰';
        concept.hooks = [
            'ğŸŒŠ æ±æ–¹ç‰ˆã€ŠåŠ å‹’æ¯”æµ·ç›œã€‹+ æµ·ä¸Šå¯†å®¤æ®ºäºº',
            'ğŸ’ ç¥ç§˜å¯¶çŸ³é€£æ¥åƒå¹´è¼ªè¿´è©›å’’',
            'ğŸ›ï¸ å”ä»£ç•°åŸŸé¢¨æƒ…ï¼šå»£å·è•ƒåŠâ†’å—æ´‹â†’å©†ç¾…æµ®å± ',
            'ğŸ‘¦ å°‘å¹´æˆé•·ï¼šå¾å°å·åˆ°è‹±é›„çš„è›»è®Š'
        ];
    } else {
        concept.logline = `åœ¨${title}çš„ä¸–ç•Œä¸­ï¼Œä¸»è§’å°‡é¢å°å‘½é‹çš„è€ƒé©—ï¼Œç¶“æ­·æˆé•·èˆ‡è›»è®Šã€‚`;
        concept.hooks = ['ç¨ç‰¹çš„ä¸–ç•Œè§€', 'æ·±åˆ»çš„è§’è‰²æˆé•·', 'æ‰£äººå¿ƒå¼¦çš„åŠ‡æƒ…'];
    }
    
    return concept;
}

// ==================== Step 3: ç« ç¯€æ‹†åˆ† ====================
function renderStep3(){
    if(state.chapters.length === 0){
        state.chapters = splitChapters();
    }
    
    return `
        <div class="content-card">
            <h3><span class="icon">ğŸ“‘</span> ç« ç¯€çµæ§‹åˆ†æ</h3>
            
            <div class="report">
                <h4>ğŸ“Š æ•´é«”æ•¸æ“š</h4>
                <div class="report-grid">
                    <div class="stat-box"><div class="stat-val">${state.chapters.length}</div><div class="stat-label">ç¸½ç« ç¯€</div></div>
                    <div class="stat-box"><div class="stat-val">${state.novel.wordCount}</div><div class="stat-label">ç¸½å­—æ•¸</div></div>
                    <div class="stat-box"><div class="stat-val">${Math.round(state.novel.wordCount / state.chapters.length)}</div><div class="stat-label">å¹³å‡å­—æ•¸/ç« </div></div>
                    <div class="stat-box"><div class="stat-val">${state.chapters.length * 80}</div><div class="stat-label">é è¨ˆç¸½é¡é ­</div></div>
                </div>
            </div>
            
            <div class="report">
                <h4>ğŸ“– ç« ç¯€åˆ—è¡¨</h4>
                ${state.chapters.map((ch, i) => `
                    <div class="item-card">
                        <h5>
                            <span style="color:var(--primary)">ç¬¬${i+1}ç« </span>
                            ${ch.title}
                        </h5>
                        <p>${ch.summary}</p>
                        <p>
                            <span class="tag">ğŸ“ ${ch.wordCount}å­—</span>
                            <span class="tag">ğŸ¬ ç´„${ch.estimatedShots}é¡é ­</span>
                            <span class="tag">${ch.phase}</span>
                        </p>
                    </div>
                `).join('')}
            </div>
            
            <div class="btn-group">
                <button class="btn" onclick="resplitChapters()">ğŸ”„ é‡æ–°æ‹†åˆ†</button>
                <button class="btn btn-primary" onclick="nextStep()">ç¢ºèª â†’ è§’è‰²è¨­è¨ˆ</button>
            </div>
        </div>
    `;
}

function splitChapters(){
    const text = state.novel.text;
    const chapters = [];
    
    // å˜—è©¦åŒ¹é…ç« ç¯€æ¨™è¨˜
    const patterns = [
        /ã€(.+?)ã€‘/g,
        /ç¬¬[ä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…«ä¹åç™¾åƒ]+ç« \s*[:ï¼š]?\s*(.+)/g,
        /Chapter\s*\d+\s*[:ï¼š]?\s*(.+)/gi
    ];
    
    let matches = [];
    for(const pattern of patterns){
        const found = [...text.matchAll(pattern)];
        if(found.length > matches.length){
            matches = found;
        }
    }
    
    if(matches.length > 0){
        for(let i = 0; i < matches.length; i++){
            const start = matches[i].index;
            const end = matches[i+1]?.index || text.length;
            const content = text.slice(start, end);
            
            chapters.push({
                id: i + 1,
                title: matches[i][1] || `ç¬¬${i+1}ç« `,
                content: content,
                wordCount: content.length,
                estimatedShots: Math.round(content.length / 200),
                phase: getChapterPhase(i, matches.length),
                summary: generateChapterSummary(content)
            });
        }
    } else {
        // æŒ‰å­—æ•¸å‡åˆ†
        const chunkSize = 15000;
        for(let i = 0; i < text.length; i += chunkSize){
            const content = text.slice(i, i + chunkSize);
            chapters.push({
                id: chapters.length + 1,
                title: `ç¬¬${chapters.length + 1}ç« `,
                content: content,
                wordCount: content.length,
                estimatedShots: Math.round(content.length / 200),
                phase: getChapterPhase(chapters.length, Math.ceil(text.length / chunkSize)),
                summary: generateChapterSummary(content)
            });
        }
    }
    
    return chapters;
}

function getChapterPhase(i, total){
    if(i === 0) return 'ğŸ¬ é–‹ç¯‡';
    if(i === total - 1) return 'ğŸ­ çµå±€';
    if(i < total * 0.25) return 'ğŸ“– é‹ªå¢Š';
    if(i < total * 0.5) return 'âš¡ ç™¼å±•';
    if(i < total * 0.75) return 'ğŸ”¥ é«˜æ½®';
    return 'ğŸŒ… æ”¶æŸ';
}

function generateChapterSummary(content){
    // ç°¡å–®æå–å‰100å­—ä½œç‚ºæ‘˜è¦
    return content.slice(0, 100).replace(/\s+/g, ' ') + '...';
}

// ==================== Step 4: è§’è‰²è¨­è¨ˆ ====================
function renderStep4(){
    if(state.characters.main.length === 0){
        state.characters = extractCharacters();
    }
    
    return `
        <div class="content-card">
            <h3><span class="icon">ğŸ‘¥</span> è§’è‰²è¨­è¨ˆ</h3>
            
            <div class="tabs">
                <div class="tab active" onclick="showCharacterTab('main')">ä¸»è§’ (${state.characters.main.length})</div>
                <div class="tab" onclick="showCharacterTab('supporting')">é…è§’ (${state.characters.supporting.length})</div>
                <div class="tab" onclick="showCharacterTab('extras')">ç¾¤æ¼” (${state.characters.extras.length})</div>
            </div>
            
            <div id="characterContent">
                ${renderCharacterList('main')}
            </div>
            
            <div class="btn-group">
                <button class="btn" onclick="reextractCharacters()">ğŸ”„ é‡æ–°åˆ†æ</button>
                <button class="btn btn-primary" onclick="nextStep()">ç¢ºèª â†’ æœåŒ–é“</button>
            </div>
        </div>
    `;
}

function showCharacterTab(type){
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    event.target.classList.add('active');
    document.getElementById('characterContent').innerHTML = renderCharacterList(type);
}

function renderCharacterList(type){
    const chars = state.characters[type] || [];
    
    if(chars.length === 0){
        return '<p style="color:var(--dim);padding:20px">æš«ç„¡è§’è‰²</p>';
    }
    
    return chars.map(c => `
        <div class="item-card">
            <h5>
                <span class="subject-type ${type === 'extras' ? 'crowd' : 'person'}">${type === 'main' ? 'ä¸»è§’' : type === 'supporting' ? 'é…è§’' : 'ç¾¤æ¼”'}</span>
                ${c.name}
            </h5>
            <p><strong>èº«ä»½ï¼š</strong>${c.role}</p>
            <p><strong>å¤–è²Œï¼š</strong>${c.appearance}</p>
            <p><strong>æ€§æ ¼ï¼š</strong>${c.personality}</p>
            ${c.motivation ? `<p><strong>å‹•æ©Ÿï¼š</strong>${c.motivation}</p>` : ''}
            <div class="prompt-box">
                <div class="prompt-label">ğŸ–¼ï¸ AI Prompt</div>
                ${c.prompt}
            </div>
        </div>
    `).join('');
}

function extractCharacters(){
    const text = state.novel.text;
    
    // é€™è£¡æ‡‰è©²æ˜¯AIåˆ†æï¼Œç¾åœ¨ç”¨ç¤ºä¾‹æ•¸æ“š
    return {
        main: [
            {
                name: 'å°çŒ´å­',
                role: 'ä¸»è§’ / å°‘å¹´ç¥å·',
                appearance: '13æ­²ï¼Œç˜¦å°éˆæ´»ï¼Œæ©Ÿè­¦çš„çœ¼ç¥ï¼Œçš®è†šç•¥é»‘',
                personality: 'æ©Ÿæ™ºç‹¡é» ï¼Œå¤–å†·å…§ç†±ï¼Œæ¸´æœ›è¢«èªåŒ',
                motivation: 'å°‹æ‰¾èº«ä¸–çœŸç›¸ï¼Œè­‰æ˜è‡ªå·±çš„åƒ¹å€¼',
                prompt: '13 year old Chinese boy, thin and agile, alert eyes, tanned skin, ragged clothes, Tang dynasty street thief, anime style, detailed character design --ar 2:3'
            },
            {
                name: 'å°è©è–©è »',
                role: 'å¥³ä¸»è§’ / ç¥ç§˜å°‘å¥³',
                appearance: '15æ­²ï¼Œæ¸…éº—è„«ä¿—ï¼Œå¦‚è©è–©èˆ¬å¯§éœï¼Œç™½è¡£ç´ æ·¨',
                personality: 'æº«æŸ”ç¥ç§˜ï¼Œä¼¼ä¹çŸ¥é“å¾ˆå¤šç§˜å¯†',
                motivation: 'å®ˆè­·å¯¶çŸ³ï¼Œå®Œæˆè¼ªè¿´çš„ä½¿å‘½',
                prompt: '15 year old Southeast Asian girl, serene like bodhisattva, white dress, prayer beads, mysterious aura, Tang dynasty style, anime --ar 2:3'
            }
        ],
        supporting: [
            {
                name: 'è•ƒé•·',
                role: 'å¤§é£Ÿå•†äºº / èˆ¹éšŠé ˜è¢–',
                appearance: '45æ­²ï¼Œé«˜å¤§é­æ¢§ï¼Œçµ¡è…®é¬ï¼Œæ·±æ²‰çš„çœ¼ç¥',
                personality: 'å¨åš´ä¸­å¸¶æ†‚é¬±ï¼ŒèƒŒè² ç§˜å¯†',
                prompt: 'Middle Eastern merchant captain, 45yo, tall muscular, thick beard, turbaned, gold accessories, Tang dynasty, dignified --ar 2:3'
            },
            {
                name: 'åœå¤¢å¸«',
                role: 'å åœå¸« / ç¥ç§˜äººç‰©',
                appearance: 'å¹´é½¡ä¸è©³ï¼Œè’™é¢ï¼Œæ·¡è¤è‰²çœ¼çœ¸',
                personality: 'è¨€èªå¦‚è¬ï¼Œäº¦æ­£äº¦é‚ª',
                prompt: 'Mysterious fortune teller, veiled face, amber eyes, purple robes, silver chains, incense smoke, Tang dynasty mystic --ar 2:3'
            },
            {
                name: 'ç´…é«®ç›²è€äºº',
                role: 'æ¸¯å£èªªæ›¸äºº / å¼•è·¯äºº',
                appearance: '70æ­²ï¼Œæ¯ç˜¦ï¼Œç´…é«®ï¼ˆç•°æ—è¡€çµ±ï¼‰ï¼Œé›™ç›®å¤±æ˜',
                personality: 'æ™ºæ…§æ·±é‚ƒï¼Œæ¯å€‹æ•…äº‹éƒ½æœ‰æ·±æ„',
                prompt: 'Old blind storyteller, 70yo, thin, red hair, milky blind eyes, bamboo cane, grey robes, Tang dynasty port --ar 2:3'
            }
        ],
        extras: [
            {
                name: 'è•ƒåŠå•†è²©',
                role: 'èƒŒæ™¯ç¾¤æ¼”',
                appearance: 'å„åœ‹å•†äººæ··é›œï¼Œæœé£¾å¤šæ¨£ï¼Œå«è³£å†å–',
                prompt: 'Crowded Tang dynasty port marketplace, diverse merchants from Arabia Persia India, colorful goods, bustling atmosphere --ar 16:9'
            },
            {
                name: 'èˆ¹å“¡æ°´æ‰‹',
                role: 'èƒŒæ™¯ç¾¤æ¼”',
                appearance: 'èµ¤è†Šæˆ–çŸ­æ‰“ï¼Œçš®è†šé»é»‘ï¼Œæ¬é‹è²¨ç‰©',
                prompt: 'Tang dynasty ship crew, muscular sailors, carrying cargo, wooden ship deck, sea background --ar 16:9'
            },
            {
                name: 'æµ·ç›œåœ˜',
                role: 'èƒŒæ™¯ç¾¤æ¼” / åæ´¾',
                appearance: 'é¢ç›®çŒ™ç°ï¼ŒæŒåˆ€æŒåŠï¼Œé»‘å¸†èˆ¹',
                prompt: 'Fierce sea pirates, Tang dynasty era, wielding swords, black sailed ship, menacing expressions --ar 16:9'
            }
        ]
    };
}

// ==================== Step 5: æœåŒ–é“ ====================
function renderStep5(){
    return `
        <div class="content-card">
            <h3><span class="icon">ğŸ‘”</span> æœåŒ–é“è¨­è¨ˆ</h3>
            
            <div class="report">
                <h4>ğŸ¨ æ•´é«”ç¾è¡“é¢¨æ ¼</h4>
                <div class="item-card">
                    <p><strong>è¦–è¦ºåŸºèª¿ï¼š</strong>æ±æ–¹å¥‡å¹» Ã— å”ä»£ç•°åŸŸé¢¨æƒ…</p>
                    <p><strong>è‰²å½©æ–¹æ¡ˆï¼š</strong>é‡‘è¤æš–è‰²ï¼ˆç¹è¯ï¼‰+ è—ç¶ å†·è‰²ï¼ˆç¥ç§˜ï¼‰+ ç´…é»‘å¼·èª¿ï¼ˆå±æ©Ÿï¼‰</p>
                    <p><strong>åƒè€ƒï¼š</strong>æ•¦ç…Œå£ç•« + ã€Šé•·å®‰åäºŒæ™‚è¾°ã€‹</p>
                </div>
            </div>
            
            <div class="report">
                <h4>ğŸ‘” ä¸»è¦è§’è‰²æœè£</h4>
                ${state.characters.main.concat(state.characters.supporting.slice(0,2)).map(c => `
                    <div class="item-card">
                        <h5>${c.name}</h5>
                        <p><strong>åŸºç¤æœè£ï¼š</strong>${getCostumeDesc(c.name)}</p>
                        <p><strong>è®Šè£å ´æ™¯ï¼š</strong>${getCostumeVariants(c.name)}</p>
                    </div>
                `).join('')}
            </div>
            
            <div class="report">
                <h4>ğŸº é—œéµé“å…·</h4>
                <div class="item-card">
                    <h5>ğŸ’ ç²‰ç´…å¯¶çŸ³</h5>
                    <p>æ ¸å¿ƒé“å…·ï¼Œæ•£ç™¼æ·¡æ·¡ç²‰å…‰ï¼Œå¯å¼•ç™¼å¹»è±¡</p>
                </div>
                <div class="item-card">
                    <h5>ğŸ”— éŠ€éˆ</h5>
                    <p>åœå¤¢å¸«çš„å åœå·¥å…·ï¼Œæ‡¸æ›å¯¶çŸ³</p>
                </div>
                <div class="item-card">
                    <h5>ğŸš¢ å¤§è•ƒèˆ¶</h5>
                    <p>å”ä»£å¤§å‹å•†èˆ¹ï¼Œå¯è¼‰æ•¸ç™¾äººï¼Œä¸‰å±¤ç”²æ¿</p>
                </div>
            </div>
            
            <div class="btn-group">
                <button class="btn btn-primary" onclick="nextStep()">ç¢ºèª â†’ ç« ç¯€åŠ‡æœ¬</button>
            </div>
        </div>
    `;
}

function getCostumeDesc(name){
    const costumes = {
        'å°çŒ´å­': 'ç ´èˆŠç°è¤è‰²çŸ­æ‰“ï¼Œè…°ç¹«å¸ƒå¸¶ï¼Œèµ¤è¶³æˆ–è‰é‹',
        'å°è©è–©è »': 'ç™½è‰²å—æ´‹é¢¨æ ¼é•·è£™ï¼Œé ­æˆ´éŠ€é£¾ï¼Œè…•æˆ´ä½›ç ',
        'è•ƒé•·': 'å¤§é£Ÿé¢¨æ ¼é•·è¢ï¼Œé ­çºå¸ƒå·¾ï¼Œä½©æˆ´é‡‘é£¾',
        'åœå¤¢å¸«': 'æ·±ç´«è‰²è’™é¢é•·è¢ï¼ŒéŠ€è³ªé£¾å“'
    };
    return costumes[name] || 'å¾…è¨­è¨ˆ';
}

function getCostumeVariants(name){
    const variants = {
        'å°çŒ´å­': 'ä¸Šèˆ¹å¾Œæ›æ°´æ‰‹çŸ­æ‰“ / æ½›å…¥æ™‚æ›æ·±è‰²å¤œè¡Œè¡£',
        'å°è©è–©è »': 'å„€å¼æ™‚æ›é‡‘çµ²ç¹”ç´‹ç¦®æœ',
        'è•ƒé•·': 'ä½œæˆ°æ™‚åŠ æŠ«è‚©ç”²',
        'åœå¤¢å¸«': 'ç„¡è®ŠåŒ–ï¼Œå§‹çµ‚ç¥ç§˜'
    };
    return variants[name] || 'ç„¡';
}

// ==================== Step 6: ç« ç¯€åŠ‡æœ¬ ====================
function renderStep6(){
    return `
        <div class="content-card">
            <h3><span class="icon">âœï¸</span> ç« ç¯€åŠ‡æœ¬ç”Ÿæˆ</h3>
            
            <div class="tabs">
                ${state.chapters.slice(0,5).map((ch, i) => `
                    <div class="tab ${i===0?'active':''}" onclick="showChapterScript(${i})">${ch.title}</div>
                `).join('')}
            </div>
            
            <div id="scriptContent">
                ${renderChapterScript(0)}
            </div>
            
            <div class="btn-group">
                <button class="btn btn-primary" onclick="nextStep()">ç¢ºèª â†’ åˆ†é¡è¨­è¨ˆ</button>
            </div>
        </div>
    `;
}

function showChapterScript(index){
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    event.target.classList.add('active');
    document.getElementById('scriptContent').innerHTML = renderChapterScript(index);
}

function renderChapterScript(index){
    const ch = state.chapters[index];
    const scenes = generateSceneBreakdown(ch);
    
    return `
        <div class="report">
            <h4>ç¬¬${index+1}ç« ï¼š${ch.title}</h4>
            <p style="color:var(--dim);margin-bottom:16px">é è¨ˆå ´æ™¯ï¼š${scenes.length}å ´ | é è¨ˆé¡é ­ï¼š${ch.estimatedShots}å€‹</p>
            
            ${scenes.map((sc, i) => `
                <div class="item-card">
                    <h5>å ´æ™¯ ${i+1}ï¼š${sc.location}</h5>
                    <p><span class="tag">${sc.time}</span> <span class="tag">${sc.weather}</span></p>
                    <p style="margin-top:8px"><strong>å…§å®¹ï¼š</strong>${sc.description}</p>
                    <p><strong>è§’è‰²ï¼š</strong>${sc.characters.join('ã€')}</p>
                    <p><strong>æƒ…ç·’ï¼š</strong>${sc.emotion}</p>
                </div>
            `).join('')}
        </div>
    `;
}

function generateSceneBreakdown(chapter){
    // ç°¡åŒ–ç‰ˆå ´æ™¯æ‹†åˆ†
    return [
        {location:'èŒ…è‰æ£šå…§', time:'å¤œ', weather:'é¦™ç…™ç¹šç¹', description:'å åœå„€å¼é€²è¡Œä¸­ï¼Œå°çŒ´å­ä¼ºæ©Ÿå·å–å¯¶çŸ³', characters:['å°çŒ´å­','åœå¤¢å¸«','æ³¢æ–¯è²´å©¦'], emotion:'ç¥ç§˜ç·Šå¼µ'},
        {location:'è•ƒåŠè¡—é“', time:'é»ƒæ˜', weather:'æ™´', description:'å°çŒ´å­é€ƒé›¢ç¾å ´ï¼Œç©¿æ¢­æ–¼ç†™æ”˜äººç¾¤', characters:['å°çŒ´å­','è•ƒåŠå•†è²©'], emotion:'ç·Šå¼µåˆºæ¿€'},
        {location:'æ¦•æ¨¹ä¸‹', time:'å¤œ', weather:'å¾®é¢¨', description:'ç´…é«®ç›²è€äººè¬›è¿°æµ·ä¸Šå‚³èªª', characters:['å°çŒ´å­','ç´…é«®ç›²è€äºº'], emotion:'ç¥ç§˜å¼•å°'}
    ];
}

// ==================== Step 7: åˆ†é¡è¨­è¨ˆï¼ˆæ ¸å¿ƒï¼‰ ====================
function renderStep7(){
    if(state.storyboard.length === 0){
        state.storyboard = generateStoryboard();
    }
    
    return `
        <div class="content-card">
            <h3><span class="icon">ğŸ¬</span> åˆ†é¡è¨­è¨ˆ</h3>
            <p style="color:var(--dim);margin-bottom:20px">æ¯å€‹é¡é ­åŒ…å«ï¼š<strong>å ´æ™¯ä¿¡æ¯</strong> + <strong>ä¸»é«”ä¿¡æ¯</strong> + <strong>AI Prompt</strong></p>
            
            <div class="report">
                <div class="report-grid">
                    <div class="stat-box"><div class="stat-val">${state.storyboard.length}</div><div class="stat-label">ç¸½é¡é ­</div></div>
                    <div class="stat-box"><div class="stat-val">${state.storyboard.filter(s=>s.subject.type==='person').length}</div><div class="stat-label">äººç‰©é¡é ­</div></div>
                    <div class="stat-box"><div class="stat-val">${state.storyboard.filter(s=>s.subject.type==='crowd').length}</div><div class="stat-label">ç¾¤æ¼”é¡é ­</div></div>
                    <div class="stat-box"><div class="stat-val">${state.storyboard.filter(s=>s.subject.type==='none').length}</div><div class="stat-label">ç©ºé¡é ­</div></div>
                </div>
            </div>
            
            <div style="max-height:600px;overflow-y:auto">
                ${state.storyboard.slice(0,10).map(shot => renderShotCard(shot)).join('')}
                
                ${state.storyboard.length > 10 ? `
                    <p style="text-align:center;padding:20px;color:var(--dim)">
                        ... å…± ${state.storyboard.length} å€‹é¡é ­ï¼Œå®Œæ•´å…§å®¹è«‹å°å‡ºæŸ¥çœ‹
                    </p>
                ` : ''}
            </div>
            
            <div class="btn-group">
                <button class="btn" onclick="regenerateStoryboard()">ğŸ”„ é‡æ–°ç”Ÿæˆ</button>
                <button class="btn btn-primary" onclick="nextStep()">ç¢ºèª â†’ å®Œæˆè¼¸å‡º</button>
            </div>
        </div>
    `;
}

function renderShotCard(shot){
    const subjectType = SUBJECT_TYPES[shot.subject.type];
    
    return `
        <div class="item-card" style="border-left:3px solid var(--primary)">
            <h5>
                <span class="shot-id">#${shot.id}</span>
                <span class="shot-type ${shot.shotType}">${shot.shotType === 'narrative' ? 'ğŸ“–æ•˜äº‹' : shot.shotType === 'dramatic' ? 'ğŸ¯æˆ²åŠ‡' : 'ğŸ¨æƒ…æ„Ÿ'}</span>
                <span style="color:var(--dim);font-weight:normal;margin-left:auto">${shot.duration}</span>
            </h5>
            
            <!-- 1ï¸âƒ£ åˆ†é¡Agentï¼šæƒ…ç¯€ -->
            <div class="agent-output" style="background:rgba(255,107,53,.1);border:1px solid rgba(255,107,53,.3);border-radius:8px;padding:12px;margin:8px 0">
                <div style="font-size:10px;color:var(--primary);font-weight:600;margin-bottom:8px">1ï¸âƒ£ åˆ†é¡Agent | æƒ…ç¯€</div>
                <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;font-size:12px">
                    <span><strong>é¡å‹ï¼š</strong>${shot.shotType === 'narrative' ? 'æ•˜äº‹' : shot.shotType === 'dramatic' ? 'æˆ²åŠ‡' : 'æƒ…æ„Ÿ'}</span>
                    <span><strong>æ™‚é•·ï¼š</strong>${shot.duration}</span>
                    <span><strong>æ©Ÿä½ï¼š</strong>${shot.camera.angle}</span>
                </div>
                <div style="font-size:12px;margin-top:8px;color:var(--dim)">
                    <strong>æ•˜äº‹åŠŸèƒ½ï¼š</strong>${shot.narrativeFunction || 'æ¨é€²æƒ…ç¯€ï¼Œå»ºç«‹å ´æ™¯'}
                </div>
            </div>
            
            <!-- 2ï¸âƒ£ ä¸»é«”Agentï¼šè§’è‰² -->
            <div class="agent-output" style="background:rgba(6,182,212,.1);border:1px solid rgba(6,182,212,.3);border-radius:8px;padding:12px;margin:8px 0">
                <div style="font-size:10px;color:var(--cyan);font-weight:600;margin-bottom:8px">2ï¸âƒ£ ä¸»é«”Agent | è§’è‰²</div>
                <div style="display:flex;align-items:center;gap:8px;margin-bottom:8px">
                    <span class="subject-type ${shot.subject.type}">${subjectType.icon} ${subjectType.label}</span>
                    <span style="font-weight:600">${shot.subject.name}</span>
                </div>
                ${shot.subject.type !== 'none' ? `
                    <div style="font-size:12px;color:var(--dim)">
                        <p><strong>å‹•ä½œï¼š</strong>${shot.subject.action}</p>
                        <p><strong>è¡¨æƒ…ï¼š</strong>${shot.subject.expression}</p>
                        <p><strong>é‹é¡ï¼š</strong>${shot.camera.movement}</p>
                    </div>
                ` : '<p style="font-size:12px;color:var(--dim)">ç©ºé¡é ­ï¼Œç„¡ä¸»é«”</p>'}
                ${shot.subject.dialogue ? `
                    <div style="background:var(--surface);padding:10px;border-radius:6px;margin-top:8px;border-left:3px solid var(--cyan)">
                        <div style="font-size:10px;color:var(--cyan);margin-bottom:4px">ğŸ’¬ ${shot.subject.name} | ${shot.subject.tone}</div>
                        <div style="font-style:italic">"${shot.subject.dialogue}"</div>
                    </div>
                ` : ''}
            </div>
            
            <!-- 3ï¸âƒ£ å ´æ™¯Agentï¼šç¾è¡“ -->
            <div class="agent-output" style="background:rgba(168,85,247,.1);border:1px solid rgba(168,85,247,.3);border-radius:8px;padding:12px;margin:8px 0">
                <div style="font-size:10px;color:var(--purple);font-weight:600;margin-bottom:8px">3ï¸âƒ£ å ´æ™¯Agent | ç¾è¡“</div>
                <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;font-size:12px">
                    <span><strong>åœ°é»ï¼š</strong>${shot.scene.location}</span>
                    <span><strong>æ™‚é–“ï¼š</strong>${shot.scene.time}</span>
                    <span><strong>è‰²èª¿ï¼š</strong>${shot.scene.colorTone}</span>
                    <span><strong>ç‡ˆå…‰ï¼š</strong>${shot.scene.lighting}</span>
                </div>
                <div style="font-size:12px;margin-top:8px;color:var(--dim)">
                    <strong>æ°›åœï¼š</strong>${shot.scene.atmosphere || 'ç¥ç§˜ç·Šå¼µ'}
                </div>
                <div style="font-size:12px;margin-top:4px;color:var(--dim)">
                    <strong>é“å…·ï¼š</strong>${shot.scene.props || 'é¦™çˆã€ç‡­å°ã€éŠ€éˆ'}
                </div>
            </div>
            
            <!-- 4ï¸âƒ£ éŸ³æ¨‚Agentï¼šè²éŸ³ -->
            <div class="agent-output" style="background:rgba(236,72,153,.1);border:1px solid rgba(236,72,153,.3);border-radius:8px;padding:12px;margin:8px 0">
                <div style="font-size:10px;color:var(--pink);font-weight:600;margin-bottom:8px">4ï¸âƒ£ éŸ³æ¨‚Agent | è²éŸ³</div>
                <div style="font-size:12px;color:var(--dim)">
                    <p><strong>é…æ¨‚ï¼š</strong>${shot.audio?.music || 'æ‡¸ç–‘æ°›åœï¼Œä½æ²‰å¼¦æ¨‚'}</p>
                    <p><strong>éŸ³æ•ˆï¼š</strong>${shot.audio?.sfx || 'é¦™ç‡­ç‡ƒç‡’è²'}</p>
                    <p><strong>ç’°å¢ƒéŸ³ï¼š</strong>${shot.audio?.ambient || 'é è™•å¸‚é›†å–§å›‚'}</p>
                </div>
            </div>
            
            <!-- ğŸ–¼ï¸ æœ€çµ‚Prompt -->
            <div class="prompt-box">
                <div class="prompt-label">ğŸ–¼ï¸ ç¶œåˆPromptï¼ˆå ´æ™¯+ä¸»é«”ï¼‰</div>
                ${shot.prompt.mj}
            </div>
        </div>
    `;
}

function generateStoryboard(){
    const shots = [];
    const shotTypes = ['narrative', 'narrative', 'dramatic', 'narrative', 'emotional'];
    
    // ç”Ÿæˆç¤ºä¾‹åˆ†é¡ï¼ˆå››å±¤Agentå®Œæ•´æ•¸æ“šï¼‰
    const sampleShots = [
        {
            scene: {location:'èŒ…è‰æ£šå…§', time:'å¤œ', colorTone:'æš–é»ƒ+ç²‰ç´…', lighting:'ç‡­å…‰å´å…‰', atmosphere:'ç¥ç§˜ç·Šå¼µ', props:'é¦™çˆã€ç‡­å°ã€è‰è“†'},
            subject: {type:'person', name:'å°çŒ´å­', action:'èœ·ç¸®åœ¨æˆ¿æ¢ä¸Šï¼Œä¿¯è¦–ä¸‹æ–¹', expression:'å°ˆæ³¨ç·Šå¼µï¼Œçœ¼ç¥éŠ³åˆ©', dialogue:null, tone:null},
            camera: {angle:'ä¿¯æ‹', movement:'ç·©æ…¢æ¨é€²'},
            audio: {music:'æ‡¸ç–‘å¼¦æ¨‚ï¼Œä½æ²‰æ¼¸å¼·', sfx:'æœ¨æ¢è¼•å¾®å±å‘€è²', ambient:'é è™•èŸ²é³´'},
            narrativeFunction:'å»ºç«‹ä¸»è§’è¦–è§’ï¼Œè£½é€ æ‡¸å¿µ',
            shotType: 'dramatic'
        },
        {
            scene: {location:'èŒ…è‰æ£šå…§', time:'å¤œ', colorTone:'æš–é»ƒ+ç²‰ç´…', lighting:'ç‡­å…‰+å¯¶çŸ³å…‰', atmosphere:'è©­ç•°ç¥ç§˜', props:'éŠ€éˆã€ç²‰ç´…å¯¶çŸ³ã€é¦™ç…™'},
            subject: {type:'person', name:'åœå¤¢å¸«', action:'æ‰‹æŒéŠ€éˆï¼Œå¯¶çŸ³æ‡¸ç©º', expression:'ç¥ç§˜è«æ¸¬', dialogue:'ä½ çš„å‘½é‹...å·²è¢«çœ‹è¦‹...', tone:'ä½æ²‰ç¥ç§˜'},
            camera: {angle:'ä¸­æ™¯', movement:'å›ºå®š'},
            audio: {music:'ç¥ç§˜åŸå”±ï¼Œç•°åŸŸé¢¨æƒ…', sfx:'å¯¶çŸ³å—¡é³´è²', ambient:'é¦™ç…™ç¹šç¹è²'},
            narrativeFunction:'æ­ç¤ºç¥ç§˜å…ƒç´ ï¼Œå»ºç«‹æ°›åœ',
            shotType: 'narrative'
        },
        {
            scene: {location:'èŒ…è‰æ£šå…§', time:'å¤œ', colorTone:'ç²‰ç´…ç‚ºä¸»', lighting:'å¯¶çŸ³ç™¼å…‰', atmosphere:'è¶…è‡ªç„¶', props:'ç²‰ç´…å¯¶çŸ³ç‰¹å¯«'},
            subject: {type:'object', name:'ç²‰ç´…å¯¶çŸ³', action:'ç™¼å‡ºæŸ”å’Œå…‰èŠ’', expression:null, dialogue:null, tone:null},
            camera: {angle:'ç‰¹å¯«', movement:'ç·©æ…¢æ—‹è½‰'},
            audio: {music:'ç©ºéˆå¥³è²å“¼å”±', sfx:'æ°´æ™¶æŒ¯å‹•è²', ambient:'éœéŸ³å¼·èª¿'},
            narrativeFunction:'æ ¸å¿ƒé“å…·ç‰¹å¯«ï¼Œå¼·åŒ–ç¥ç§˜æ„Ÿ',
            shotType: 'emotional'
        },
        {
            scene: {location:'è•ƒåŠè¡—é“', time:'é»ƒæ˜', colorTone:'é‡‘é»ƒæš–è‰²', lighting:'å¤•é™½å´å…‰', atmosphere:'ç¹è¯ç†±é¬§', props:'å„åœ‹è²¨ç‰©ã€æ”¤ä½ã€æ——å¹Ÿ'},
            subject: {type:'crowd', name:'è•ƒåŠå•†è²©', action:'å«è³£å†å–ï¼Œäººæµç©¿æ¢­', expression:'å¿™ç¢Œç†±é¬§', dialogue:null, tone:null},
            camera: {angle:'å¤§å…¨æ™¯', movement:'å‡é™é¡é ­'},
            audio: {music:'ç•°åŸŸé¢¨æƒ…é…æ¨‚ï¼Œç†±é¬§', sfx:'å¸‚é›†å–§å›‚ã€å«è³£è²', ambient:'é§éˆ´è²ã€é¦¬è¹„è²'},
            narrativeFunction:'å»ºç«‹ä¸–ç•Œè§€ï¼Œå±•ç¤ºå”ä»£è•ƒåŠ',
            shotType: 'narrative'
        },
        {
            scene: {location:'è•ƒåŠè¡—é“', time:'é»ƒæ˜', colorTone:'é‡‘é»ƒæš–è‰²', lighting:'å¤•é™½é€†å…‰', atmosphere:'ç·Šå¼µè¿½é€', props:'äººç¾¤ã€æ”¤ä½ï¼ˆè¢«æ’ç¿»ï¼‰'},
            subject: {type:'person', name:'å°çŒ´å­', action:'ç©¿æ¢­äººç¾¤ï¼Œå¿«é€Ÿå¥”è·‘', expression:'ç·Šå¼µä½†è‡ªä¿¡', dialogue:null, tone:null},
            camera: {angle:'è·Ÿæ‹', movement:'æ‰‹æŒè·Ÿéš¨'},
            audio: {music:'ç¯€å¥åŠ å¿«ï¼Œæ‰“æ“Šæ¨‚', sfx:'è…³æ­¥è²ã€ç¢°æ’è²', ambient:'é©šå‘¼è²'},
            narrativeFunction:'è¿½é€æˆ²ï¼Œå±•ç¤ºä¸»è§’èƒ½åŠ›',
            shotType: 'dramatic'
        },
        {
            scene: {location:'æ¦•æ¨¹ä¸‹', time:'å¤œ', colorTone:'è—ç¶ å†·è‰²', lighting:'æœˆå…‰', atmosphere:'ç¥ç§˜å¼•å°', props:'è€æ¦•æ¨¹ã€ç«¹æ–ã€è‰è“†'},
            subject: {type:'person', name:'ç´…é«®ç›²è€äºº', action:'ååœ¨æ¨¹ä¸‹ï¼Œè‹¥æœ‰æ‰€æ€', expression:'æ·±é‚ƒæ™ºæ…§', dialogue:'åœ¨æµ·çš„é‚£ä¸€é‚Š...æœ‰ä¸€åº§å±±...', tone:'è’¼è€ç¥ç§˜'},
            camera: {angle:'ä¸­æ™¯', movement:'å›ºå®š'},
            audio: {music:'å¤ç®ç¨å¥ï¼Œæ‚ é ', sfx:'æ¨¹è‘‰æ²™æ²™è²', ambient:'è›™é³´ã€èŸ²è²'},
            narrativeFunction:'å°å¸«è§’è‰²ç™»å ´ï¼ŒåŸ‹ä¸‹ä¼ç­†',
            shotType: 'narrative'
        },
        {
            scene: {location:'ç¢¼é ­', time:'æ¸…æ™¨', colorTone:'é’è—', lighting:'æ™¨éœ§æ•£å°„', atmosphere:'å£¯é—˜å•Ÿèˆª', props:'å¤§è•ƒèˆ¶ã€ç¢¼é ­ã€è²¨ç‰©'},
            subject: {type:'none', name:'å¤§è•ƒèˆ¶', action:'èˆ¹éš»éœæ³Š', expression:null, dialogue:null, tone:null},
            camera: {angle:'å¤§å…¨æ™¯', movement:'ç·©æ…¢æ©«ç§»'},
            audio: {music:'å²è©©å¼¦æ¨‚ï¼Œæ¼¸å¼·', sfx:'æµ·æµªè²ã€æµ·é·—è²', ambient:'æ¸¯å£ä½œæ¥­è²'},
            narrativeFunction:'ç©ºé¡è½‰å ´ï¼Œå±•ç¤ºå†’éšªè¼‰é«”',
            shotType: 'narrative'
        },
        {
            scene: {location:'èˆ¹è‰™å…§', time:'å¤œ', colorTone:'æš—ç´…', lighting:'æ²¹ç‡ˆ', atmosphere:'å£“æŠ‘ä¸å®‰', props:'æ²¹ç‡ˆã€èˆªæµ·åœ–ã€é…’æ¯'},
            subject: {type:'person', name:'è•ƒé•·', action:'ç«™ç«‹æ²‰æ€ï¼ŒèƒŒå°é¡é ­', expression:'æ†‚é¬±æ·±æ²‰', dialogue:'é€™è¶Ÿèˆªè¡Œ...ä¸æœƒå¤ªå¹³...', tone:'ä½æ²‰å¨åš´'},
            camera: {angle:'èƒŒå½±', movement:'ç·©æ…¢æ¨é€²'},
            audio: {music:'ä½æ²‰å¤§æç´', sfx:'èˆ¹é«”æ–æ™ƒè²', ambient:'æµ·æµªæ‹æ‰“èˆ¹èº«'},
            narrativeFunction:'è£½é€ æ‡¸å¿µï¼Œæš—ç¤ºå±éšª',
            shotType: 'dramatic'
        }
    ];
    
    // ç”Ÿæˆæ›´å¤šé¡é ­
    for(let i = 0; i < 30; i++){
        const template = sampleShots[i % sampleShots.length];
        const shot = JSON.parse(JSON.stringify(template));
        shot.id = String(i + 1).padStart(3, '0');
        shot.duration = (2 + Math.random() * 4).toFixed(1) + 's';
        shot.prompt = {
            mj: generateMJPrompt(shot)
        };
        shots.push(shot);
    }
    
    return shots;
}

function generateMJPrompt(shot){
    let prompt = '';
    
    // å ´æ™¯éƒ¨åˆ†
    prompt += `${shot.scene.location}, ${shot.scene.time}, ${shot.scene.colorTone} color palette, ${shot.scene.lighting}, `;
    
    // ä¸»é«”éƒ¨åˆ†
    if(shot.subject.type === 'person'){
        prompt += `${shot.subject.name} ${shot.subject.action}, ${shot.subject.expression}, `;
    } else if(shot.subject.type === 'crowd'){
        prompt += `${shot.subject.name} ${shot.subject.action}, `;
    } else if(shot.subject.type === 'object'){
        prompt += `${shot.subject.name} ${shot.subject.action}, `;
    }
    
    // æ”å½±éƒ¨åˆ†
    prompt += `${shot.camera.angle}, ${shot.camera.movement}, `;
    
    // é¢¨æ ¼
    prompt += 'Tang dynasty era, cinematic, anime style, 8K --ar 16:9 --v 6';
    
    return prompt;
}

// ==================== Step 8: å®Œæˆè¼¸å‡º ====================
function renderStep8(){
    const totalShots = state.storyboard.length;
    const totalChapters = state.chapters.length;
    const totalChars = state.characters.main.length + state.characters.supporting.length;
    
    return `
        <div class="content-card">
            <h3><span class="icon">ğŸ‰</span> è£½ä½œå®Œæˆï¼</h3>
            
            <div class="report">
                <h4>ğŸ“Š é …ç›®ç¸½è¦½</h4>
                <div class="report-grid">
                    <div class="stat-box"><div class="stat-val">${state.novel.wordCount}</div><div class="stat-label">åŸè‘—å­—æ•¸</div></div>
                    <div class="stat-box"><div class="stat-val">${totalChapters}</div><div class="stat-label">ç« ç¯€æ•¸</div></div>
                    <div class="stat-box"><div class="stat-val">${totalChars}</div><div class="stat-label">è§’è‰²æ•¸</div></div>
                    <div class="stat-box"><div class="stat-val">${totalShots}</div><div class="stat-label">ç¸½é¡é ­</div></div>
                </div>
            </div>
            
            <div class="report">
                <h4>ğŸ“ è¼¸å‡ºæ–‡æª”æ¸…å–®</h4>
                <div class="item-card">
                    <p>ğŸ“„ <strong>concept.json</strong> - é«˜æ¦‚å¿µå®šä½</p>
                    <p>ğŸ“„ <strong>chapters.json</strong> - ç« ç¯€çµæ§‹</p>
                    <p>ğŸ“„ <strong>characters.json</strong> - è§’è‰²è¨­è¨ˆï¼ˆå«Promptï¼‰</p>
                    <p>ğŸ“„ <strong>costumes.json</strong> - æœåŒ–é“è¨­è¨ˆ</p>
                    <p>ğŸ“„ <strong>storyboard.json</strong> - å®Œæ•´åˆ†é¡è¡¨</p>
                    <p>ğŸ“„ <strong>prompts_mj.txt</strong> - Midjourney Prompts</p>
                </div>
            </div>
            
            <div class="btn-group">
                <button class="btn" onclick="exportJSON()">ğŸ“„ å°å‡ºJSON</button>
                <button class="btn" onclick="exportCSV()">ğŸ“Š å°å‡ºCSV</button>
                <button class="btn" onclick="exportPrompts()">ğŸ–¼ï¸ å°å‡ºPrompts</button>
                <button class="btn btn-primary" onclick="location.reload()">é–‹å§‹æ–°é …ç›®</button>
            </div>
        </div>
    `;
}

// ==================== å°å‡ºåŠŸèƒ½ ====================
function exportJSON(){
    const data = {
        project: state.novel.title,
        concept: state.concept,
        chapters: state.chapters.map(c => ({id:c.id, title:c.title, wordCount:c.wordCount})),
        characters: state.characters,
        storyboard: state.storyboard
    };
    
    download(JSON.stringify(data, null, 2), `${state.novel.title}_å®Œæ•´æ•¸æ“š.json`, 'application/json');
}

function exportCSV(){
    let csv = 'é¡é ­ID,é¡å‹,æ™‚é•·,å ´æ™¯,æ™‚é–“,è‰²èª¿,ç‡ˆå…‰,ä¸»é«”é¡å‹,ä¸»é«”åç¨±,å‹•ä½œ,è¡¨æƒ…,å°è©,æ©Ÿä½,Prompt\n';
    
    state.storyboard.forEach(s => {
        csv += `${s.id},${s.shotType},${s.duration},"${s.scene.location}",${s.scene.time},"${s.scene.colorTone}","${s.scene.lighting}",${s.subject.type},"${s.subject.name}","${s.subject.action || ''}","${s.subject.expression || ''}","${s.subject.dialogue || ''}","${s.camera.angle}","${s.prompt.mj}"\n`;
    });
    
    download(csv, `${state.novel.title}_åˆ†é¡è¡¨.csv`, 'text/csv');
}

function exportPrompts(){
    let txt = `# ${state.novel.title} - AI Prompts\n\n`;
    
    txt += '## è§’è‰²Prompts\n\n';
    [...state.characters.main, ...state.characters.supporting].forEach(c => {
        txt += `### ${c.name}\n${c.prompt}\n\n`;
    });
    
    txt += '## åˆ†é¡Prompts\n\n';
    state.storyboard.forEach(s => {
        txt += `### Shot #${s.id}\n${s.prompt.mj}\n\n`;
    });
    
    download(txt, `${state.novel.title}_Prompts.txt`, 'text/plain');
}

function download(content, filename, type){
    const blob = new Blob([content], {type: type + ';charset=utf-8'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
}

function updateOutputPanel(){
    const files = [];
    
    if(state.concept.logline) files.push({name:'concept.json', size:'2KB'});
    if(state.chapters.length) files.push({name:'chapters.json', size:`${state.chapters.length}ç« `});
    if(state.characters.main.length) files.push({name:'characters.json', size:`${state.characters.main.length + state.characters.supporting.length}è§’è‰²`});
    if(state.storyboard.length) files.push({name:'storyboard.json', size:`${state.storyboard.length}é¡é ­`});
    
    document.getElementById('outputFiles').innerHTML = files.map(f => `
        <div class="output-file">
            <span class="icon">ğŸ“„</span>
            <span class="name">${f.name}</span>
            <span class="size">${f.size}</span>
        </div>
    `).join('') || '<p style="color:var(--dim);font-size:12px">å°šæœªç”Ÿæˆ</p>';
}

// ==================== ç¤ºä¾‹æ•¸æ“š ====================
const DEMO_NOVEL = `ã€Šæµ·ä¸Šçµ²ç¶¢ä¹‹è·¯å¯†ç¢¼ã€‹

é¡å‹ï¼šæ­·å²å†’éšª / æ‡¸ç–‘ / æ±æ–¹å¥‡å¹»
æ™‚ä»£ï¼šå”ä»£
åœ°é»ï¼šå»£å·è•ƒåŠ â†’ å—æ´‹èˆªç·š â†’ å©†ç¾…æµ®å± 

ã€æ¥”å­ã€‘
èŒ…è‰æ£šå…§ï¼Œé¦™ç…™ç¹šç¹ã€‚å å¤¢å¸«æ‰‹æŒéŠ€éˆï¼Œç²‰ç´…è‰²çš„å…‰å¾æ³¢æ–¯è²´å©¦çš„èƒ¸å£é€å‡ºã€‚
å°çŒ´å­è—åœ¨æˆ¿æ¢ä¸Šï¼Œç­‰å¾…æ™‚æ©Ÿã€‚ä»–æ˜¯è•ƒåŠæœ€éˆæ´»çš„å°å·ã€‚
ç•¶ä»–çš„æ‰‹æŒ‡è§¸ç¢°é‚£é¡†ç²‰ç´…å¯¶çŸ³æ™‚ï¼Œè©­ç•°çš„å¹»è±¡é–ƒéè…¦æµ·â€”â€”é®®è¡€ã€ç«ç„°ã€é‚„æœ‰ä¸€å€‹å°‘å¥³çš„è‡‰...

ã€ç¬¬ä¸€ç«  å»£å·è•ƒåŠã€‘
æ€€åœ£å¯ºçš„å…‰å¡”é«˜è³ï¼Œé‡‘é ‚åœ¨å¤•é™½ä¸‹é–ƒè€€ã€‚é€™æ˜¯å¤§å”æœ€ç¹è¯çš„æ¸¯å£ï¼Œå„åœ‹å•†äººé›²é›†æ–¼æ­¤ã€‚
ç´…é«®ç›²è€äººåœ¨æ¦•æ¨¹ä¸‹è¬›è¿°æµ·ä¸Šå‚³èªªï¼Œå­©å­å€‘åœåè†è½ã€‚ã€Œåœ¨æµ·çš„é‚£ä¸€é‚Šï¼Œæœ‰ä¸€åº§å±±ï¼Œå±±ä¸Šæœ‰åº§å¡”ï¼Œå¡”è£¡è—è‘—åƒå¹´çš„ç§˜å¯†...ã€
å°çŒ´å­ç©¿æ¢­åœ¨ç†™æ”˜çš„äººç¾¤ä¸­ï¼Œä»–çš„ç›®æ¨™æ˜¯é‚£å€‹æ³¢æ–¯å•†äººçš„éŒ¢è¢‹ã€‚ä½†ä»Šå¤©çš„æ”¶ç©«ï¼Œé æ¯”éŒ¢è¢‹é‡è¦â€”â€”é‚£é¡†æœƒç™¼å…‰çš„ç²‰ç´…å¯¶çŸ³ã€‚

ã€ç¬¬äºŒç«  å¤œæµ·å•Ÿèˆªã€‘
å¤§è•ƒèˆ¶å¦‚å·¨ç¸ï¼Œåœæ³Šåœ¨ç¢¼é ­ã€‚é€™è‰˜èˆ¹å°‡é§›å‘å—æ´‹ï¼Œè¼‰è‘—é¦™æ–™ã€çµ²ç¶¢ï¼Œé‚„æœ‰ç„¡æ•¸äººçš„å‘½é‹ã€‚
è•ƒé•·ç«™åœ¨èˆ¹é ­ï¼Œçµ¡è…®é¬åœ¨æµ·é¢¨ä¸­é£„å‹•ã€‚ã€Œé€™è¶Ÿèˆªè¡Œ...ä¸æœƒå¤ªå¹³ã€‚ã€
å°çŒ´å­è¿½å°‹å°è©è–©è »çš„èº«å½±ï¼Œä»–å¿…é ˆç™»ä¸Šé€™è‰˜èˆ¹ã€‚é‚£é¡†å¯¶çŸ³ä¼¼ä¹åœ¨å¬å–šä»–ï¼Œå‘Šè¨´ä»–çœŸç›¸åœ¨é æ–¹...

ã€ç¬¬ä¸‰ç«  é»‘å¸†è³Šèˆ¹ã€‘
æœˆå…‰ä¸‹çš„å¤§æµ·ï¼Œé è™•å‡ºç¾é»‘è‰²å¸†å½±ã€‚
ã€Œæµ·ç›œï¼ã€ç­æœ›æ‰‹çš„é©šå«è²åŠƒç ´å¤œç©ºã€‚
ã€Œæ˜¯é£Ÿäººé­”çš„èˆ¹ï¼ã€æ°´æ‰‹å€‘é©šæè¬åˆ†ã€‚å‚³èªªé€™æ”¯æµ·ç›œå¾ä¸ç•™æ´»å£ï¼Œåªå› ä»–å€‘çš„é¦–é ˜å–œæ­¡æ”¶é›†äººé ­...

ã€ç¬¬å››ç«  å¯†å®¤æ®ºäººã€‘
å¤©äº®æ™‚ï¼Œè‰™æˆ¿è£¡ç™¼ç¾äº†ç¬¬ä¸€å…·å±é«”ã€‚æ­»è€…æ˜¯èˆ¹ä¸Šçš„å¤§é£Ÿå•†äººï¼Œå–‰åš¨è¢«å‰²é–‹ï¼Œçœ¼ç›å»çœ‹è‘—æŸå€‹æ–¹å‘â€”â€”å¯¶çŸ³æ¶ˆå¤±çš„æ–¹å‘ã€‚
ã€Œå…‡æ‰‹å°±åœ¨æˆ‘å€‘ä¹‹ä¸­ã€‚ã€è•ƒé•·æ²‰è²èªªé“ã€‚
å°çŒ´å­æ¡ç·Šæ‡·ä¸­çš„å¯¶çŸ³ï¼Œå®ƒåˆé–‹å§‹ç™¼å…‰äº†...

ã€ç¬¬äº”ç«  è¼ªè¿´ä¹‹è¬ã€‘
ç•¶å°è©è–©è »é–‹å£èªªè©±æ™‚ï¼Œæ‰€æœ‰äººéƒ½éœ‡é©šäº†ã€‚å¥¹èªªçš„ä¸æ˜¯å”è¨€ï¼Œè€Œæ˜¯ä¸€ç¨®å¤è€çš„èªè¨€ï¼Œä¸€ç¨®åƒå¹´å‰å°±å·²æ¶ˆäº¡çš„èªè¨€ã€‚
ã€Œä¸€åˆ‡éƒ½å°‡é‡æ¼”...ã€å¥¹çš„çœ¼ç¥ç©ºæ´è€Œæ·±é‚ƒï¼Œã€Œå°±åƒåƒå¹´å‰ä¸€æ¨£...ã€
åœå¤¢å¸«çš„éŠ€éˆé–‹å§‹æ–æ™ƒï¼šã€Œè¼ªè¿´çš„é–éˆï¼Œå·²ç¶“é–‹å§‹æ–·è£‚...ã€`;

// ==================== åˆå§‹åŒ– ====================
document.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>
