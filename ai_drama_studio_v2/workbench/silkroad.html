<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æµ·ä¸Šçµ²ç¶¢ä¹‹è·¯å¯†ç¢¼ - AIç•ªåŠ‡åˆ†é¡è¡¨</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Serif+SC:wght@400;600&display=swap');
        *{margin:0;padding:0;box-sizing:border-box}
        :root{
            --bg:#0a0a0c;--surface:#12121a;--surface2:#1a1a24;
            --border:#2a2a36;--text:#e8e8ec;--dim:#6b6b7a;
            --gold:#daa520;--red:#c53030;--cyan:#38b2ac;
            --pink:#ff6b9d;
        }
        body{font-family:'Inter',system-ui,sans-serif;background:var(--bg);color:var(--text);min-height:100vh}
        
        /* Header */
        .header{background:linear-gradient(180deg,var(--surface) 0%,var(--bg) 100%);border-bottom:1px solid var(--border);padding:20px 32px}
        .header-top{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}
        .logo{font-family:'Noto Serif SC',serif;font-size:28px;color:var(--gold);font-weight:600}
        .logo span{color:var(--dim);font-size:14px;font-family:'Inter';margin-left:12px}
        .header-actions{display:flex;gap:8px}
        .btn{padding:10px 20px;border:1px solid var(--border);background:var(--surface2);color:var(--text);border-radius:6px;cursor:pointer;font-size:13px;font-weight:500;transition:all .15s}
        .btn:hover{border-color:var(--gold)}
        .btn-primary{background:var(--gold);border-color:var(--gold);color:#000}
        .btn-primary:hover{background:#c9961a}
        
        /* Stats */
        .stats-bar{display:flex;gap:32px;padding:16px 0;border-top:1px solid var(--border)}
        .stat{text-align:center}
        .stat-val{font-size:32px;font-weight:700;color:var(--gold);font-family:'Inter'}
        .stat-label{font-size:11px;color:var(--dim);text-transform:uppercase;letter-spacing:1px;margin-top:4px}
        
        /* Main */
        .main{display:flex;height:calc(100vh - 160px)}
        
        /* Sidebar */
        .sidebar{width:280px;background:var(--surface);border-right:1px solid var(--border);overflow-y:auto}
        .sidebar-section{padding:16px;border-bottom:1px solid var(--border)}
        .sidebar-section h3{font-size:11px;text-transform:uppercase;letter-spacing:1px;color:var(--dim);margin-bottom:12px}
        
        .episode-list{list-style:none}
        .episode-item{padding:12px;border-radius:8px;cursor:pointer;margin-bottom:4px;transition:all .15s}
        .episode-item:hover{background:var(--surface2)}
        .episode-item.active{background:var(--gold);color:#000}
        .episode-item .ep-num{font-weight:700;font-size:12px}
        .episode-item .ep-title{font-size:14px;margin-top:2px}
        .episode-item .ep-info{font-size:11px;color:var(--dim);margin-top:4px}
        .episode-item.active .ep-info{color:rgba(0,0,0,0.6)}
        
        .character-list{display:flex;flex-wrap:wrap;gap:8px}
        .char-tag{padding:6px 12px;background:var(--surface2);border-radius:20px;font-size:12px}
        
        /* Content */
        .content{flex:1;overflow-y:auto;padding:24px}
        
        .episode-header{margin-bottom:24px}
        .episode-header h1{font-family:'Noto Serif SC',serif;font-size:24px;color:var(--gold);margin-bottom:8px}
        .episode-header .logline{color:var(--dim);font-size:14px;line-height:1.6}
        
        /* Shot Grid */
        .shot-filters{display:flex;gap:12px;margin-bottom:20px;flex-wrap:wrap}
        .filter-btn{padding:6px 14px;background:var(--surface2);border:1px solid var(--border);border-radius:20px;font-size:12px;cursor:pointer;transition:all .15s}
        .filter-btn:hover,.filter-btn.active{border-color:var(--gold);color:var(--gold)}
        
        .shot-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:16px}
        
        .shot-card{background:var(--surface);border:1px solid var(--border);border-radius:12px;overflow:hidden;transition:all .2s}
        .shot-card:hover{border-color:var(--gold);transform:translateY(-2px)}
        .shot-header{padding:12px 16px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center}
        .shot-id{font-weight:700;color:var(--gold);font-size:14px}
        .shot-type{font-size:11px;padding:4px 8px;background:var(--surface2);border-radius:4px}
        .shot-type.narrative{color:var(--cyan)}
        .shot-type.dramatic{color:var(--pink)}
        .shot-type.emotional{color:var(--gold)}
        
        .shot-body{padding:16px}
        .shot-scene{font-size:12px;color:var(--dim);margin-bottom:8px}
        .shot-desc{font-size:13px;line-height:1.5;margin-bottom:12px}
        .shot-meta{display:flex;gap:8px;flex-wrap:wrap}
        .shot-tag{font-size:10px;padding:3px 8px;background:var(--bg);border-radius:4px;color:var(--dim)}
        
        .shot-prompt{padding:12px 16px;background:var(--bg);border-top:1px solid var(--border);font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--cyan);line-height:1.5;cursor:pointer}
        .shot-prompt:hover{background:var(--surface2)}
        
        /* Export Modal */
        .modal{position:fixed;inset:0;background:rgba(0,0,0,.85);display:flex;align-items:center;justify-content:center;z-index:1000;padding:24px;backdrop-filter:blur(8px)}
        .modal.hide{display:none}
        .modal-box{background:var(--surface);border:1px solid var(--border);border-radius:16px;width:100%;max-width:800px;max-height:85vh;overflow:hidden}
        .modal-header{padding:20px 24px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center}
        .modal-header h2{font-size:18px;font-weight:600}
        .modal-close{background:none;border:none;color:var(--dim);font-size:24px;cursor:pointer}
        .modal-body{padding:24px;overflow-y:auto;max-height:calc(85vh - 140px)}
        .modal-footer{padding:16px 24px;border-top:1px solid var(--border);display:flex;gap:8px;justify-content:flex-end}
        
        .export-preview{background:var(--bg);border:1px solid var(--border);border-radius:8px;padding:16px;font-family:'JetBrains Mono',monospace;font-size:12px;max-height:400px;overflow-y:auto;white-space:pre-wrap}
        
        /* Toast */
        .toast{position:fixed;bottom:24px;right:24px;background:var(--gold);color:#000;padding:12px 20px;border-radius:8px;font-size:13px;font-weight:500;opacity:0;transform:translateY(20px);transition:all .3s}
        .toast.show{opacity:1;transform:translateY(0)}
    </style>
</head>
<body>
    <header class="header">
        <div class="header-top">
            <div class="logo">æµ·ä¸Šçµ²ç¶¢ä¹‹è·¯å¯†ç¢¼<span>AIç•ªåŠ‡åˆ†é¡è¡¨</span></div>
            <div class="header-actions">
                <button class="btn" onclick="exportJSON()">å°å‡º JSON</button>
                <button class="btn" onclick="exportCSV()">å°å‡º CSV</button>
                <button class="btn btn-primary" onclick="exportAll()">å°å‡ºå…¨éƒ¨</button>
            </div>
        </div>
        <div class="stats-bar">
            <div class="stat"><div class="stat-val" id="totalEps">10</div><div class="stat-label">é›†æ•¸</div></div>
            <div class="stat"><div class="stat-val" id="totalShots">1000</div><div class="stat-label">ç¸½é¡é ­</div></div>
            <div class="stat"><div class="stat-val" id="totalDuration">80</div><div class="stat-label">åˆ†é˜</div></div>
            <div class="stat"><div class="stat-val" id="totalChars">5</div><div class="stat-label">è§’è‰²</div></div>
        </div>
    </header>
    
    <div class="main">
        <aside class="sidebar">
            <div class="sidebar-section">
                <h3>é›†æ•¸åˆ—è¡¨</h3>
                <ul class="episode-list" id="episodeList"></ul>
            </div>
            <div class="sidebar-section">
                <h3>ä¸»è¦è§’è‰²</h3>
                <div class="character-list" id="charList"></div>
            </div>
            <div class="sidebar-section">
                <h3>è¦–è¦ºé¢¨æ ¼</h3>
                <p style="font-size:12px;color:var(--dim);line-height:1.6">å”é¢¨ç•°åŸŸ Ã— å—æ´‹å¥‡å¹»<br>åƒè€ƒï¼šåˆºå®¢è¶éš±å¨˜ã€å¦–è²“å‚³ã€åŠ å‹’æ¯”æµ·ç›œ</p>
            </div>
        </aside>
        
        <main class="content" id="content">
            <div class="episode-header" id="epHeader">
                <h1>ç¬¬1é›†ï¼šè•ƒåŠæš—å½±</h1>
                <p class="logline">å°çŒ´å­åœ¨å»£å·è•ƒåŠè¡Œç«Šï¼Œå·å¾—ä¸€é¡†ç¥ç§˜ç²‰ç´…å¯¶çŸ³ï¼Œå»å¼•ç™¼è©­ç•°å¹»è±¡ã€‚</p>
            </div>
            
            <div class="shot-filters">
                <button class="filter-btn active" data-filter="all">å…¨éƒ¨</button>
                <button class="filter-btn" data-filter="narrative">æ•˜äº‹é¡é ­</button>
                <button class="filter-btn" data-filter="dramatic">æˆ²åŠ‡é¡é ­</button>
                <button class="filter-btn" data-filter="emotional">æƒ…æ„Ÿé¡é ­</button>
            </div>
            
            <div class="shot-grid" id="shotGrid"></div>
        </main>
    </div>
    
    <div class="modal hide" id="exportModal">
        <div class="modal-box">
            <div class="modal-header">
                <h2>å°å‡ºé è¦½</h2>
                <button class="modal-close" onclick="closeModal()">Ã—</button>
            </div>
            <div class="modal-body">
                <pre class="export-preview" id="exportPreview"></pre>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="closeModal()">é—œé–‰</button>
                <button class="btn btn-primary" onclick="downloadExport()">ä¸‹è¼‰</button>
            </div>
        </div>
    </div>
    
    <div class="toast" id="toast">å·²è¤‡è£½åˆ°å‰ªè²¼æ¿</div>

<script>
// é …ç›®æ•¸æ“šï¼ˆå…§åµŒï¼‰
const projectData = {
    "title": "æµ·ä¸Šçµ²ç¶¢ä¹‹è·¯å¯†ç¢¼",
    "episodes": [
        {"ep":1,"title":"è•ƒåŠæš—å½±","shots":100,"duration":8,"logline":"å°çŒ´å­åœ¨å»£å·è•ƒåŠè¡Œç«Šï¼Œå·å¾—ä¸€é¡†ç¥ç§˜ç²‰ç´…å¯¶çŸ³ï¼Œå»å¼•ç™¼è©­ç•°å¹»è±¡ã€‚"},
        {"ep":2,"title":"å¤œæµ·å•Ÿèˆª","shots":75,"duration":6,"logline":"å°çŒ´å­ç™»ä¸Šè•ƒé•·çš„å•†èˆ¹ï¼Œè¿½å°‹å°è©è–©è »çš„ä¸‹è½ï¼Œå¤§æµ·çš„å†’éšªé–‹å§‹ã€‚"},
        {"ep":3,"title":"é»‘å¸†ä¾†è¥²","shots":100,"duration":8,"logline":"æµ·ç›œä¾†è¥²ï¼Œå•†èˆ¹å±åœ¨æ—¦å¤•ã€‚å°çŒ´å­åœ¨è‰™é ‚ç›®ç¹é©šäººä¸€å¹•ã€‚"},
        {"ep":4,"title":"èˆ¹ä¸Šé¢¨é›²","shots":85,"duration":7,"logline":"å®´æœƒä¹‹å¾Œï¼Œèˆ¹ä¸Šçš„äººæ¥é€£åšèµ·æ€ªå¤¢ã€‚ç²‰ç´…å¯¶çŸ³çš„è©›å’’é–‹å§‹é¡¯ç¾ã€‚"},
        {"ep":5,"title":"å‘½æ¡ˆè¿·éœ§","shots":75,"duration":6,"logline":"èˆ¹é•·é›¢å¥‡æ­»äº¡ï¼Œèˆ¹ä¸Šäººäººè‡ªå±ã€‚å°çŒ´å­é–‹å§‹èª¿æŸ¥çœŸç›¸ã€‚"},
        {"ep":6,"title":"åº•è‰™è¡€å¤œ","shots":100,"duration":8,"logline":"åº•è‰™å‚³ä¾†æ…˜å«ï¼Œåˆä¸€äººå€’åœ¨è¡€æ³Šä¸­ã€‚å…‡æ‰‹æ˜¯èª°ï¼Ÿ"},
        {"ep":7,"title":"æµ·è³Šå·¢ç©´","shots":120,"duration":10,"logline":"å•†èˆ¹é§›å…¥æµ·è³Šçš„åœ°ç›¤ï¼Œå‚³èªªä¸­çš„é£Ÿäººé­”å³¶å°±åœ¨å‰æ–¹ã€‚"},
        {"ep":8,"title":"è•ƒé•·å¾€äº‹","shots":100,"duration":8,"logline":"è•ƒé•·æ­é–‹éå»çš„ç§˜å¯†ï¼Œè¼ªè¿´çš„è©›å’’èˆ‡ç²‰ç´…å¯¶çŸ³çš„ä¾†æ­·æµ®ç¾ã€‚"},
        {"ep":9,"title":"æ®ºå±€çµ‚ç« ","shots":130,"duration":10,"logline":"æ‰€æœ‰ç·šç´¢æŒ‡å‘åŒä¸€å€‹äººã€‚å·¨èˆ¶ä¹‹ä¸Šï¼Œç”Ÿæ­»å°æ±ºã€‚"},
        {"ep":10,"title":"çœŸç›¸èˆ‡æ­¸é€”","shots":115,"duration":9,"logline":"å©†ç¾…æµ®å± çš„ç¥å»Ÿä¸­ï¼ŒçœŸç›¸å¤§ç™½ã€‚å°çŒ´å­æ‰¾åˆ°äº†ä»–è¦æ‰¾çš„äººã€‚"}
    ],
    "characters": [
        {"name":"å°çŒ´å­","role":"ä¸»è§’"},
        {"name":"å°è©è–©è »","role":"æ ¸å¿ƒé…è§’"},
        {"name":"è•ƒé•·","role":"é‡è¦é…è§’"},
        {"name":"åœå¤¢å¸«","role":"ç¥ç§˜è§’è‰²"},
        {"name":"æ³¢æ–¯è²´å©¦","role":"è§¸ç™¼è§’è‰²"}
    ]
};

// å ´æ™¯æ¨¡æ¿
const sceneTemplates = [
    {scene:"å åœæ£š",descs:["èŒ…è‰æ£šå…§ï¼Œé¦™ç…™ç¹šç¹ï¼Œåœå¤¢å¸«æ‰‹æŒéŠ€éˆ","æ³¢æ–¯è²´å©¦è’™è‘—é»‘ç´—ï¼Œé–‰çœ¼è¬›è¿°å¤¢å¢ƒ","ç²‰ç´…è‰²çš„å…‰å¾å¥¹èƒ¸å£é€å‡º"]},
    {scene:"æˆ¿æ¢",descs:["å°çŒ´å­è—åœ¨èŒ…è‰é–“ï¼Œçœ¼ç›é–ƒçˆ","ä»–ç·©ç·©æ”¾ä¸‹è‰ç¹©ï¼Œèº«å½¢è¼•ç›ˆå¦‚å½±","å€’æ›ç¹©ç´¢ï¼Œæ‰‹æŒ‡è§¸ç¢°é …éˆæ­æ‰£"]},
    {scene:"è•ƒåŠè¡—å··",descs:["è¿·å®®èˆ¬çš„å°å··ï¼Œèƒ¡äººèˆ‡æ¼¢äººæ“¦è‚©è€Œé","éœ“è™¹èˆ¬çš„ç‡ˆç± åœ¨å¤œè‰²ä¸­æ–æ›³","é è™•æ€€åœ£å¯ºçš„å…‰å¡”é–ƒçˆé‡‘å…‰"]},
    {scene:"æ€€åœ£å¯º",descs:["å…‰å¡”ä¸‹ï¼Œç´…é«®ç›²è€äººè¬›è¿°æµ·ä¸Šå‚³èªª","ä¸‰ç™¾å¹´çš„è€æ¦•æ¨¹ä¸‹ï¼Œè½çœ¾åœæˆå¹¾åœˆ","å°çŒ´å­ååœ¨å¤–åœï¼Œçœ¼ç¥é£„å‘é æ–¹"]},
    {scene:"æµ·å±±æ¨“",descs:["ä¿¯ç°ç æ±Ÿï¼Œé è™•æ˜¯å¤§æµ·èˆ‡å¸†èˆ¹","ä¸‰å±¤é–£æ¨“é ‚ï¼Œè•ƒé•·èˆ‡å¸‚èˆ¶å¸å®˜å“¡å°é£²","å°çŒ´å­æ½›å…¥ï¼Œè—åœ¨æš—è™•è§€å¯Ÿ"]},
    {scene:"ç¢¼é ­",descs:["å¤§è•ƒèˆ¶åœæ³Šï¼Œè²¨ç‰©å¦‚å±±","æ°´æ‰‹å¿™ç¢Œè£èˆ¹ï¼Œå„è‰²äººç­‰æ“æ“ ","å»£å·åŸåœ¨èº«å¾Œï¼Œå†’éšªå³å°‡é–‹å§‹"]},
    {scene:"ç”²æ¿",descs:["å•†èˆ¹å‡ºæµ·ï¼Œé¢¨å¸†é¼“èµ·","å°çŒ´å­ç«™åœ¨èˆ¹é ­ï¼Œçœ‹è‘—ç„¡ç›¡çš„å¤§æµ·","æ—¥è½æŸ“ç´…å¤©éš›ï¼Œå£¯éº—çš„æ™¯è±¡"]},
    {scene:"èˆ¹è‰™",descs:["ç‹¹çª„çš„èˆ¹è‰™ï¼Œå„è‰²äººç­‰æ“ åœ¨ä¸€èµ·","æ²¹ç‡ˆæ–æ›³ï¼Œå½±å­åœ¨ç‰†ä¸Šèˆå‹•","æœ‰äººåœ¨è§’è½ä½è²äº¤è«‡"]},
    {scene:"å¤œæµ·",descs:["æœˆå…‰ç‘åœ¨æµ·é¢ï¼ŒéŠ€è‰²æ³¢å…‰","é è™•å‡ºç¾é»‘è‰²å¸†å½±ï¼Œä¸ç¥¥çš„é å…†","èˆ¹ä¸Šçš„äººç·Šå¼µåœ°æ³¨è¦–è‘—"]},
    {scene:"æµ·ç›œèˆ¹",descs:["é»‘å¸†æµ·ç›œèˆ¹é€¼è¿‘ï¼Œæ——å¹Ÿåœ¨é¢¨ä¸­çµçµ","æµ·ç›œå€‘æ‰‹æŒå½åˆ€ï¼Œè™è¦–çœˆçœˆ","ç”²æ¿ä¸Šçš„æé¬¥ï¼Œåˆ€å…‰åŠå½±"]}
];

// ç”Ÿæˆåˆ†é¡æ•¸æ“š
function generateShots(episode) {
    const ep = projectData.episodes[episode-1];
    const shots = [];
    const types = ["å»ºç«‹é¡é ­","é æ™¯","ä¸­æ™¯","ä¸­æ™¯","è¿‘æ™¯","è¿‘æ™¯","ç‰¹å¯«","è·Ÿæ‹","ä¸»è§€é¡é ­"];
    const categories = ["narrative","narrative","narrative","dramatic","dramatic","emotional"];
    const emotions = ["ç¥ç§˜","ç·Šå¼µ","æœŸå¾…","ææ‡¼","å¸Œæœ›","éœ‡é©š","æ†¤æ€’","æº«æƒ…"];
    
    for(let i=1; i<=ep.shots; i++){
        const sceneIdx = Math.floor((i-1) / (ep.shots/7)) % sceneTemplates.length;
        const scene = sceneTemplates[sceneIdx];
        const desc = scene.descs[Math.floor(Math.random()*scene.descs.length)];
        
        shots.push({
            id: i,
            episode: episode,
            scene: scene.scene,
            type: types[Math.floor(Math.random()*types.length)],
            category: categories[Math.floor(Math.random()*categories.length)],
            desc: desc,
            emotion: emotions[Math.floor(Math.random()*emotions.length)],
            prompt: `${desc}, Tang dynasty aesthetic, ${emotions[Math.floor(Math.random()*emotions.length)]} mood, cinematic lighting, dramatic shadows, 8k, masterpiece --ar 16:9 --v 6`
        });
    }
    return shots;
}

let currentEpisode = 1;
let currentShots = [];
let currentFilter = 'all';
let exportData = null;
let exportFilename = '';

function init() {
    // æ¸²æŸ“é›†æ•¸åˆ—è¡¨
    const list = document.getElementById('episodeList');
    list.innerHTML = projectData.episodes.map((ep,i) => `
        <li class="episode-item${i===0?' active':''}" onclick="selectEpisode(${ep.ep})">
            <div class="ep-num">ç¬¬${ep.ep}é›†</div>
            <div class="ep-title">${ep.title}</div>
            <div class="ep-info">${ep.shots}é¡é ­ Â· ${ep.duration}åˆ†é˜</div>
        </li>
    `).join('');
    
    // æ¸²æŸ“è§’è‰²
    document.getElementById('charList').innerHTML = projectData.characters.map(c => 
        `<span class="char-tag">${c.name}</span>`
    ).join('');
    
    // ç¯©é¸æŒ‰éˆ•
    document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.onclick = () => {
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            currentFilter = btn.dataset.filter;
            renderShots();
        };
    });
    
    selectEpisode(1);
}

function selectEpisode(ep) {
    currentEpisode = ep;
    const epData = projectData.episodes[ep-1];
    
    // æ›´æ–°åˆ—è¡¨é«˜äº®
    document.querySelectorAll('.episode-item').forEach((el,i) => {
        el.classList.toggle('active', i === ep-1);
    });
    
    // æ›´æ–°æ¨™é¡Œ
    document.getElementById('epHeader').innerHTML = `
        <h1>ç¬¬${ep}é›†ï¼š${epData.title}</h1>
        <p class="logline">${epData.logline}</p>
    `;
    
    // ç”Ÿæˆé¡é ­
    currentShots = generateShots(ep);
    renderShots();
}

function renderShots() {
    let shots = currentShots;
    if(currentFilter !== 'all') {
        shots = shots.filter(s => s.category === currentFilter);
    }
    
    document.getElementById('shotGrid').innerHTML = shots.map(s => `
        <div class="shot-card">
            <div class="shot-header">
                <span class="shot-id">#${String(s.id).padStart(3,'0')}</span>
                <span class="shot-type ${s.category}">${s.type}</span>
            </div>
            <div class="shot-body">
                <div class="shot-scene">ğŸ“ ${s.scene}</div>
                <div class="shot-desc">${s.desc}</div>
                <div class="shot-meta">
                    <span class="shot-tag">${s.category==='narrative'?'ğŸ“–æ•˜äº‹':s.category==='dramatic'?'ğŸ¯æˆ²åŠ‡':'ğŸ¨æƒ…æ„Ÿ'}</span>
                    <span class="shot-tag">${s.emotion}</span>
                </div>
            </div>
            <div class="shot-prompt" onclick="copyPrompt(this)">${s.prompt}</div>
        </div>
    `).join('');
}

function copyPrompt(el) {
    navigator.clipboard.writeText(el.textContent);
    showToast('å·²è¤‡è£½Prompt');
}

function showToast(msg) {
    const toast = document.getElementById('toast');
    toast.textContent = msg;
    toast.classList.add('show');
    setTimeout(() => toast.classList.remove('show'), 2000);
}

function getAllShots() {
    const all = [];
    for(let ep=1; ep<=10; ep++) {
        const shots = generateShots(ep);
        shots.forEach(s => {
            s.episode_title = projectData.episodes[ep-1].title;
            all.push(s);
        });
    }
    return all;
}

function exportJSON() {
    const allShots = getAllShots();
    const data = {
        project: projectData.title,
        generated: new Date().toISOString(),
        total_shots: allShots.length,
        episodes: projectData.episodes,
        storyboard: allShots
    };
    exportData = JSON.stringify(data, null, 2);
    exportFilename = 'silkroad_storyboard.json';
    document.getElementById('exportPreview').textContent = exportData.substring(0, 3000) + '\n\n... (å…±' + allShots.length + 'å€‹é¡é ­)';
    document.getElementById('exportModal').classList.remove('hide');
}

function exportCSV() {
    const allShots = getAllShots();
    const headers = ['Shot','Episode','Episode_Title','Scene','Type','Category','Description','Emotion','Prompt'];
    const rows = allShots.map(s => [
        s.id, s.episode, s.episode_title, s.scene, s.type, s.category,
        '"'+s.desc.replace(/"/g,'""')+'"', s.emotion, '"'+s.prompt.replace(/"/g,'""')+'"'
    ]);
    exportData = [headers.join(','), ...rows.map(r => r.join(','))].join('\n');
    exportFilename = 'silkroad_storyboard.csv';
    document.getElementById('exportPreview').textContent = exportData.substring(0, 3000) + '\n\n... (å…±' + allShots.length + 'è¡Œ)';
    document.getElementById('exportModal').classList.remove('hide');
}

function exportAll() {
    const allShots = getAllShots();
    let txt = `ã€Šæµ·ä¸Šçµ²ç¶¢ä¹‹è·¯å¯†ç¢¼ã€‹AIç•ªåŠ‡åˆ†é¡è¡¨\nç”Ÿæˆæ™‚é–“ï¼š${new Date().toLocaleString()}\nç¸½é¡é ­æ•¸ï¼š${allShots.length}\n\n`;
    
    projectData.episodes.forEach(ep => {
        txt += `\n${'='.repeat(60)}\n`;
        txt += `ç¬¬${ep.ep}é›†ï¼š${ep.title}\n`;
        txt += `æ™‚é•·ï¼š${ep.duration}åˆ†é˜ | é¡é ­ï¼š${ep.shots}å€‹\n`;
        txt += `æ¦‚è¦ï¼š${ep.logline}\n`;
        txt += `${'='.repeat(60)}\n\n`;
        
        const epShots = allShots.filter(s => s.episode === ep.ep);
        epShots.forEach(s => {
            txt += `[#${String(s.id).padStart(3,'0')}] ${s.type} | ${s.scene}\n`;
            txt += `æè¿°ï¼š${s.desc}\n`;
            txt += `æƒ…ç·’ï¼š${s.emotion} | åˆ†é¡ï¼š${s.category}\n`;
            txt += `Promptï¼š${s.prompt}\n\n`;
        });
    });
    
    exportData = txt;
    exportFilename = 'silkroad_storyboard_full.txt';
    document.getElementById('exportPreview').textContent = txt.substring(0, 3000) + '\n\n... (å®Œæ•´æ–‡æª”)';
    document.getElementById('exportModal').classList.remove('hide');
}

function closeModal() {
    document.getElementById('exportModal').classList.add('hide');
}

function downloadExport() {
    const blob = new Blob([exportData], {type: 'text/plain;charset=utf-8'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = exportFilename;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    closeModal();
    showToast('ä¸‹è¼‰æˆåŠŸ');
}

document.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>
