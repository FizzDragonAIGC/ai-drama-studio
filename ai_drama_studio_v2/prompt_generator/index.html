<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIç•ªå‰§ Prompt ç”Ÿæˆå™¨ v2.0</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0a0a0a;
            color: #fff;
            min-height: 100vh;
        }

        .container {
            max-width: 720px;
            margin: 0 auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        header {
            text-align: center;
            padding: 30px 0 15px;
            border-bottom: 1px solid #222;
        }

        header h1 {
            font-size: 1.4rem;
            font-weight: 600;
            background: linear-gradient(90deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        header p { color: #666; font-size: 0.85rem; margin-top: 6px; }

        .stats {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 12px;
            font-size: 0.75rem;
        }

        .stat {
            background: #1a1a1a;
            padding: 6px 12px;
            border-radius: 20px;
            color: #888;
        }

        .stat span { color: #4ade80; font-weight: 600; }

        .agent-bar {
            display: flex;
            overflow-x: auto;
            gap: 8px;
            padding: 15px 0;
            scrollbar-width: none;
        }

        .agent-bar::-webkit-scrollbar { display: none; }

        .agent-chip {
            flex-shrink: 0;
            padding: 6px 12px;
            border-radius: 16px;
            font-size: 0.75rem;
            background: #1a1a1a;
            border: 1px solid #333;
            color: #888;
            transition: all 0.3s;
            cursor: default;
        }

        .agent-chip.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-color: transparent;
            color: #fff;
        }

        .agent-chip.done {
            background: #1a2f1a;
            border-color: #4ade80;
            color: #4ade80;
        }

        .chat-container {
            flex: 1;
            overflow-y: auto;
            padding: 20px 0;
        }

        .message {
            margin-bottom: 20px;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message-agent {
            display: flex;
            gap: 12px;
        }

        .agent-avatar {
            width: 40px;
            height: 40px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            flex-shrink: 0;
        }

        .agent-content { flex: 1; }

        .agent-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 6px;
        }

        .agent-name {
            font-size: 0.8rem;
            font-weight: 600;
            color: #fff;
        }

        .agent-role {
            font-size: 0.7rem;
            color: #666;
        }

        .agent-text {
            color: #e0e0e0;
            line-height: 1.7;
            font-size: 0.95rem;
        }

        .agent-text strong { color: #fff; }

        .skill-tag {
            display: inline-block;
            background: #2a2a3a;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.7rem;
            color: #a78bfa;
            margin-top: 8px;
        }

        .message-user {
            background: #1a1a2e;
            border: 1px solid #333;
            border-radius: 12px;
            padding: 14px 16px;
            margin-left: 52px;
            color: #fff;
            font-size: 0.95rem;
        }

        .options-container {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 12px;
            margin-left: 52px;
        }

        .option-btn {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 10px 16px;
            color: #fff;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .option-btn:hover {
            background: #2a2a2a;
            border-color: #667eea;
            transform: translateY(-1px);
        }

        .input-container {
            padding: 15px 0;
            border-top: 1px solid #222;
        }

        .input-wrapper { position: relative; }

        textarea {
            width: 100%;
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 12px;
            padding: 14px 50px 14px 16px;
            color: #fff;
            font-size: 0.95rem;
            font-family: inherit;
            resize: none;
            min-height: 52px;
            max-height: 150px;
            line-height: 1.5;
        }

        textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .send-btn {
            position: absolute;
            right: 10px;
            bottom: 10px;
            width: 34px;
            height: 34px;
            border-radius: 8px;
            background: #667eea;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .send-btn svg { width: 16px; height: 16px; fill: #fff; }

        .result-box {
            background: #0f1f0f;
            border: 1px solid #2d4a2d;
            border-radius: 12px;
            padding: 16px;
            margin-top: 12px;
        }

        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .result-title {
            font-weight: 600;
            color: #4ade80;
            font-size: 0.9rem;
        }

        .copy-btn {
            background: #2d4a2d;
            border: none;
            border-radius: 6px;
            padding: 5px 10px;
            color: #4ade80;
            font-size: 0.75rem;
            cursor: pointer;
        }

        .result-content {
            background: #0a0a0a;
            border-radius: 8px;
            padding: 14px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.8rem;
            line-height: 1.6;
            color: #e0e0e0;
            white-space: pre-wrap;
            word-break: break-word;
        }

        .skills-used {
            margin-top: 16px;
            padding-top: 12px;
            border-top: 1px solid #2d4a2d;
        }

        .skills-used-title {
            font-size: 0.75rem;
            color: #888;
            margin-bottom: 8px;
        }

        .skills-list {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .skill-used {
            background: #1a1a2e;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 0.7rem;
            color: #a78bfa;
        }

        .restart-btn {
            width: 100%;
            background: transparent;
            border: 1px solid #333;
            border-radius: 10px;
            padding: 14px;
            color: #888;
            font-size: 0.9rem;
            cursor: pointer;
            margin-top: 16px;
        }

        .restart-btn:hover {
            border-color: #667eea;
            color: #fff;
        }

        .hidden { display: none !important; }

        /* Skillsé¢æ¿ */
        .skills-panel {
            position: fixed;
            top: 0;
            right: -400px;
            width: 400px;
            height: 100vh;
            background: #0f0f0f;
            border-left: 1px solid #333;
            transition: right 0.3s;
            z-index: 100;
            overflow-y: auto;
        }

        .skills-panel.open { right: 0; }

        .skills-panel-header {
            padding: 20px;
            border-bottom: 1px solid #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .skills-panel-title {
            font-weight: 600;
        }

        .close-panel {
            background: none;
            border: none;
            color: #888;
            font-size: 1.5rem;
            cursor: pointer;
        }

        .skills-panel-content {
            padding: 20px;
        }

        .skill-card {
            background: #1a1a1a;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 12px;
        }

        .skill-card-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .skill-card-name {
            font-weight: 600;
            font-size: 0.9rem;
        }

        .skill-card-book {
            font-size: 0.7rem;
            color: #888;
        }

        .skill-card-desc {
            font-size: 0.8rem;
            color: #aaa;
            line-height: 1.5;
        }

        .toggle-skills {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            z-index: 50;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ¬ AIç•ªå‰§ Prompt ç”Ÿæˆå™¨</h1>
            <p>500+ Skills Â· 25 æ™ºèƒ½ä½“ Â· ä¸“ä¸šçº§è¾“å‡º</p>
            <div class="stats">
                <div class="stat">ğŸ“š <span id="bookCount">108</span> æœ¬ä¹¦</div>
                <div class="stat">ğŸ”§ <span id="skillCount">500+</span> Skills</div>
                <div class="stat">ğŸ¤– <span id="agentCount">25</span> æ™ºèƒ½ä½“</div>
            </div>
        </header>

        <div class="agent-bar" id="agentBar"></div>

        <div class="chat-container" id="chatContainer"></div>

        <div class="input-container" id="inputContainer">
            <div class="input-wrapper">
                <textarea id="userInput" placeholder="è¾“å…¥ä½ çš„å›ç­”..." rows="1"></textarea>
                <button class="send-btn" onclick="sendMessage()">
                    <svg viewBox="0 0 24 24"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg>
                </button>
            </div>
        </div>
    </div>

    <button class="toggle-skills" onclick="toggleSkillsPanel()">ğŸ“–</button>

    <div class="skills-panel" id="skillsPanel">
        <div class="skills-panel-header">
            <span class="skills-panel-title">ğŸ”§ å½“å‰ä½¿ç”¨çš„Skills</span>
            <button class="close-panel" onclick="toggleSkillsPanel()">Ã—</button>
        </div>
        <div class="skills-panel-content" id="skillsPanelContent">
            <p style="color:#666">å¯¹è¯ä¸­ä¼šæ˜¾ç¤ºè°ƒç”¨çš„Skills...</p>
        </div>
    </div>

    <script src="skills_database.js"></script>
    <script src="skills_part2.js"></script>
    <script>
        // æ™ºèƒ½ä½“é…ç½®ï¼ˆå¸¦Skillsï¼‰
        const agents = [
            {
                id: 'welcome',
                name: 'ç³»ç»Ÿ',
                role: 'å…¥å£',
                emoji: 'ğŸ¬',
                color: '#667eea',
                skills: [],
                questions: [
                    {
                        text: 'æ¬¢è¿ä½¿ç”¨ AIç•ªå‰§ Prompt ç”Ÿæˆå™¨ï¼\n\næˆ‘å°†è°ƒç”¨ <strong>500+ ä¸“ä¸šSkills</strong>ï¼Œé€šè¿‡å¤šä¸ªæ™ºèƒ½ä½“ä¸ºä½ ç”Ÿæˆå®Œç¾çš„ Promptã€‚\n\nè¯·å…ˆå‘Šè¯‰æˆ‘ä½ çš„ <strong>æ•…äº‹/å‰§æœ¬/åˆ›æ„</strong>ï¼š',
                        type: 'textarea',
                        key: 'story'
                    }
                ]
            },
            {
                id: 'A02',
                name: 'æ•…äº‹æ¶æ„å¸ˆ',
                role: 'A02 ç¼–å‰§',
                emoji: 'ğŸ“–',
                color: '#f59e0b',
                skills: ['mcgee_story_triangle', 'mcgee_scene_design', 'snyder_beat_sheet', 'campbell_heros_journey'],
                questions: [
                    {
                        text: 'è®©æˆ‘ç”¨<strong>ã€Šæ•…äº‹ã€‹ã€Šæ•‘çŒ«å’ªã€‹ã€Šåƒé¢è‹±é›„ã€‹</strong>çš„æ–¹æ³•åˆ†æä½ çš„æ•…äº‹ã€‚\n\nè¿™ä¸ªæ•…äº‹çš„<strong>æ ¸å¿ƒå†²çª</strong>æ˜¯ä»€ä¹ˆï¼Ÿ\nï¼ˆä¸»è§’æƒ³è¦ä»€ä¹ˆï¼Ÿæ˜¯ä»€ä¹ˆé˜»ç¢äº†ä»–ï¼Ÿï¼‰',
                        type: 'textarea',
                        key: 'conflict',
                        skill: 'mcgee_scene_design'
                    },
                    {
                        text: 'æ ¹æ®<strong>ã€Šæ•‘çŒ«å’ªã€‹åç§ç±»å‹ç‰‡</strong>ï¼Œä½ çš„æ•…äº‹å±äºå“ªç§ï¼Ÿ',
                        type: 'options',
                        options: ['è‹±é›„ä¹‹æ—…/å†’é™©', 'çˆ±æƒ…/ä¼™ä¼´æƒ…', 'å›°å…½ä¹‹æ–—/ææ€–', 'æ‚¬ç–‘æ¨ç†', 'æ„šäººå¾—ç¦/é€†è¢­', 'æˆé•¿èœ•å˜', 'èµ°å‡ºå›°å¢ƒ/å¥‡å¹»', 'å…¶ä»–'],
                        key: 'genre',
                        skill: 'snyder_10_genres'
                    },
                    {
                        text: 'å‚è€ƒ<strong>ã€Šæ•…äº‹ã€‹ä»·å€¼è½¬æ¢</strong>ï¼Œè¿™ä¸ªåœºæ™¯çš„æƒ…ç»ªæ˜¯ï¼Ÿ',
                        type: 'options',
                        options: ['æ¸©æš–æ²»æ„ˆ (è´Ÿâ†’æ­£)', 'ç´§å¼ åˆºæ¿€ (ç¨³â†’å±)', 'æµªæ¼«ç”œèœœ', 'æ‚²ä¼¤æ„Ÿäºº (æ­£â†’è´Ÿ)', 'çƒ­è¡€ç‡ƒçƒ§', 'ç¥ç§˜è¯¡å¼‚', 'è½»æ¾å¹½é»˜'],
                        key: 'mood',
                        skill: 'mcgee_value_charge'
                    }
                ]
            },
            {
                id: 'A05',
                name: 'è§’è‰²è®¾è®¡å¸ˆ',
                role: 'A05 è§’è‰²',
                emoji: 'ğŸ§‘',
                color: '#ec4899',
                skills: ['campbell_archetypes', 'snyder_save_the_cat', 'mcgee_dialogue_character'],
                questions: [
                    {
                        text: 'è¿ç”¨<strong>ã€Šåƒé¢è‹±é›„ã€‹åŸå‹è§’è‰²</strong>ç†è®ºï¼Œæè¿°ä½ çš„<strong>ä¸»è§’</strong>ï¼š\nï¼ˆå¤–è²Œã€æ€§æ ¼ã€èº«ä»½ã€å¹´é¾„ï¼‰',
                        type: 'textarea',
                        key: 'protagonist',
                        skill: 'campbell_archetypes'
                    },
                    {
                        text: 'æ ¹æ®<strong>ã€Šæ•‘çŒ«å’ªã€‹"æ•‘çŒ«æ—¶åˆ»"</strong>ç†è®ºï¼Œä¸»è§’æœ‰ä»€ä¹ˆè®©äººå–œæ¬¢çš„ç‰¹ç‚¹ï¼Ÿ\nï¼ˆæ ‡å¿—æ€§ç‰¹å¾ã€å¯çˆ±ä¹‹å¤„ï¼‰',
                        type: 'textarea',
                        key: 'protagonist_feature',
                        skill: 'snyder_save_the_cat'
                    }
                ]
            },
            {
                id: 'A04',
                name: 'æ–‡åŒ–é¡¾é—®',
                role: 'A04 å†å²æ–‡åŒ–',
                emoji: 'ğŸ›ï¸',
                color: '#8b5cf6',
                skills: ['chinese_aesthetics', 'era_visual', 'japanese_culture'],
                questions: [
                    {
                        text: 'å‚è€ƒ<strong>ã€Šç¾çš„å†ç¨‹ã€‹</strong>å„æ—¶ä»£ç¾å­¦ç‰¹å¾ï¼Œæ•…äº‹çš„<strong>æ—¶ä»£èƒŒæ™¯</strong>æ˜¯ï¼Ÿ',
                        type: 'options',
                        options: ['ç°ä»£éƒ½å¸‚', 'ä¸­å›½å¤ä»£ (æ±‰å”å®‹æ˜æ¸…)', 'æ—¥æœ¬å’Œé£', 'æ¬§æ´²å†å²', 'æœªæ¥ç§‘å¹»', 'æ¶ç©ºå¹»æƒ³', 'å…¶ä»–'],
                        key: 'era',
                        skill: 'chinese_aesthetics'
                    },
                    {
                        text: 'åœºæ™¯å‘ç”Ÿåœ¨ä»€ä¹ˆ<strong>å…·ä½“åœ°ç‚¹</strong>ï¼Ÿ',
                        type: 'textarea',
                        key: 'location'
                    }
                ]
            },
            {
                id: 'A09',
                name: 'ç¾æœ¯æŒ‡å¯¼',
                role: 'A09 ç¾æœ¯',
                emoji: 'ğŸ¨',
                color: '#06b6d4',
                skills: ['gurney_color_temperature', 'gurney_atmosphere', 'mccloud_icon_spectrum'],
                questions: [
                    {
                        text: 'åŸºäº<strong>ã€Šç†è§£æ¼«ç”»ã€‹å›¾åƒæŠ½è±¡å…‰è°±</strong>å’Œç»å…¸é£æ ¼ï¼Œé€‰æ‹©<strong>ç”»é£</strong>ï¼š',
                        type: 'options',
                        options: ['æ—¥ç³»åŠ¨æ¼« (ç®€åŒ–è§’è‰²+å†™å®èƒŒæ™¯)', 'å‰åœåŠ›é£ (æ‰‹ç»˜æ¸©æš–)', 'æ–°æµ·è¯šé£ (å…‰å½±ç»†è…»)', 'èµ›åšæœ‹å…‹ (éœ“è™¹ç§‘æŠ€)', 'æ°´å¢¨å›½é£ (ä¼ ç»Ÿç¾å­¦)', 'å†™å®é£æ ¼', 'æš—é»‘å“¥ç‰¹'],
                        key: 'art_style',
                        skill: 'mccloud_icon_spectrum'
                    },
                    {
                        text: 'è¿ç”¨<strong>ã€Šè‰²å½©ä¸å…‰çº¿ã€‹å¤§æ°”æ•ˆæœ</strong>ï¼Œç”»é¢çš„æ•´ä½“æ°›å›´æ˜¯ï¼Ÿ',
                        type: 'options',
                        options: ['æ˜äº®æ¸©æš– (ç›´å°„å…‰)', 'æŸ”å’Œæ¢¦å¹» (æ¼«å°„å…‰)', 'å†·å³»å‡Œå‰ (ç¡¬å…‰)', 'å¤å¤æ€€æ—§ (æš–è°ƒ)', 'æ¸…æ–°è‡ªç„¶', 'é˜´æš—ç¥ç§˜ (ä½è°ƒå…‰)'],
                        key: 'atmosphere',
                        skill: 'gurney_atmosphere'
                    }
                ]
            },
            {
                id: 'A13',
                name: 'è‰²å½©è®¾è®¡å¸ˆ',
                role: 'A13 è‰²å½©',
                emoji: 'ğŸŒˆ',
                color: '#10b981',
                skills: ['gurney_color_harmony', 'gurney_color_temperature', 'gurney_shadow'],
                questions: [
                    {
                        text: 'æ ¹æ®<strong>ã€Šè‰²å½©ä¸å…‰çº¿ã€‹é…è‰²æ–¹æ¡ˆ</strong>ç†è®ºï¼Œé€‰æ‹©è‰²å½©ï¼š',
                        type: 'options',
                        options: ['æš–è‰²è°ƒ (çº¢æ©™é»„)', 'å†·è‰²è°ƒ (è“ç»¿ç´«)', 'äº’è¡¥è‰²å¯¹æ¯”', 'ç±»ä¼¼è‰²å’Œè°', 'å•è‰²è°ƒ', 'é«˜é¥±å’Œ', 'ä½é¥±å’Œ/æ·¡é›…'],
                        key: 'color_scheme',
                        skill: 'gurney_color_harmony'
                    }
                ]
            },
            {
                id: 'A06',
                name: 'å¯¼æ¼”',
                role: 'A06 é•œå¤´',
                emoji: 'ğŸ¥',
                color: '#f43f5e',
                skills: ['katz_shot_types', 'katz_camera_angles', 'katz_composition', 'katz_camera_movement'],
                questions: [
                    {
                        text: 'è¿ç”¨<strong>ã€Šç”µå½±é•œå¤´è®¾è®¡ã€‹æ™¯åˆ«ç³»ç»Ÿ</strong>ï¼Œè¿™ä¸ªç”»é¢ç”¨ä»€ä¹ˆ<strong>é•œå¤´</strong>ï¼Ÿ',
                        type: 'options',
                        options: ['å¤§ç‰¹å†™ (çœ¼ç›/ç»†èŠ‚)', 'ç‰¹å†™ (é¢éƒ¨)', 'è¿‘æ™¯ (è‚©éƒ¨ä»¥ä¸Š)', 'ä¸­æ™¯ (åŠèº«)', 'å…¨æ™¯ (å…¨èº«)', 'è¿œæ™¯ (ç¯å¢ƒä¸ºä¸»)'],
                        key: 'shot_type',
                        skill: 'katz_shot_types'
                    },
                    {
                        text: 'å‚è€ƒ<strong>ã€Šç”µå½±é•œå¤´è®¾è®¡ã€‹æ‹æ‘„è§’åº¦</strong>ï¼Œç”¨ä»€ä¹ˆ<strong>è§’åº¦</strong>ï¼Ÿ',
                        type: 'options',
                        options: ['å¹³è§† (ä¸­ç«‹)', 'ä»°è§† (å¨ä¸¥/å¼ºå¤§)', 'ä¿¯è§† (æ¸ºå°/è„†å¼±)', 'è·å…°è§’ (ä¸å®‰/ç–¯ç‹‚)', 'é¸Ÿç° (å…¨çŸ¥è§†è§’)'],
                        key: 'camera_angle',
                        skill: 'katz_camera_angles'
                    },
                    {
                        text: 'è§’è‰²çš„<strong>åŠ¨ä½œ/çŠ¶æ€</strong>æ˜¯ï¼Ÿ',
                        type: 'textarea',
                        key: 'action'
                    },
                    {
                        text: 'è§’è‰²çš„<strong>è¡¨æƒ…/æƒ…ç»ª</strong>æ˜¯ï¼Ÿ',
                        type: 'options',
                        options: ['å¾®ç¬‘', 'å¤§ç¬‘', 'æ‚²ä¼¤/æµæ³ª', 'æ„¤æ€’', 'æƒŠè®¶', 'ææƒ§', 'è‹¥æœ‰æ‰€æ€', 'åšå®š', 'æ¸©æŸ”', 'å†·é…·/æ— è¡¨æƒ…'],
                        key: 'expression'
                    }
                ]
            },
            {
                id: 'A18',
                name: 'Promptå·¥ç¨‹å¸ˆ',
                role: 'A18 AIè¾“å‡º',
                emoji: 'ğŸ¤–',
                color: '#667eea',
                skills: ['mj_prompt', 'sd_prompt', 'character_consistency'],
                questions: [
                    {
                        text: 'æœ€åä¸€æ­¥ï¼é€‰æ‹©<strong>ç›®æ ‡å¹³å°</strong>ï¼š',
                        type: 'options',
                        options: ['Midjourney', 'Stable Diffusion', 'Flux', 'DALL-E', 'é€šç”¨Prompt'],
                        key: 'platform',
                        skill: 'mj_prompt'
                    }
                ]
            }
        ];

        // çŠ¶æ€
        let currentAgentIndex = 0;
        let currentQuestionIndex = 0;
        let answers = {};
        let usedSkills = [];

        // åˆå§‹åŒ–
        function init() {
            renderAgentBar();
            showNextQuestion();
        }

        // æ¸²æŸ“æ™ºèƒ½ä½“å¯¼èˆªæ¡
        function renderAgentBar() {
            const bar = document.getElementById('agentBar');
            bar.innerHTML = agents.map((agent, i) => `
                <div class="agent-chip ${i === currentAgentIndex ? 'active' : ''} ${i < currentAgentIndex ? 'done' : ''}" id="chip-${i}">
                    ${agent.emoji} ${agent.name}
                </div>
            `).join('');
        }

        // æ˜¾ç¤ºä¸‹ä¸€ä¸ªé—®é¢˜
        function showNextQuestion() {
            const agent = agents[currentAgentIndex];
            if (!agent) {
                generateResult();
                return;
            }

            const question = agent.questions[currentQuestionIndex];
            if (!question) {
                currentAgentIndex++;
                currentQuestionIndex = 0;
                renderAgentBar();
                if (currentAgentIndex < agents.length) {
                    setTimeout(() => showNextQuestion(), 400);
                } else {
                    generateResult();
                }
                return;
            }

            // è®°å½•ä½¿ç”¨çš„Skill
            if (question.skill) {
                usedSkills.push(question.skill);
                updateSkillsPanel(question.skill);
            }

            addAgentMessage(agent, question.text, question.skill);

            if (question.type === 'options') {
                addOptions(question.options, question.key);
            }
        }

        // æ·»åŠ æ™ºèƒ½ä½“æ¶ˆæ¯
        function addAgentMessage(agent, text, skillId) {
            const container = document.getElementById('chatContainer');
            const skillTag = skillId ? `<div class="skill-tag">ğŸ”§ è°ƒç”¨: ${skillId}</div>` : '';
            
            container.innerHTML += `
                <div class="message">
                    <div class="message-agent">
                        <div class="agent-avatar" style="background: ${agent.color}">${agent.emoji}</div>
                        <div class="agent-content">
                            <div class="agent-header">
                                <span class="agent-name">${agent.name}</span>
                                <span class="agent-role">${agent.role}</span>
                            </div>
                            <div class="agent-text">${text.replace(/\n/g, '<br>')}</div>
                            ${skillTag}
                        </div>
                    </div>
                </div>
            `;
            scrollToBottom();
        }

        // æ·»åŠ é€‰é¡¹
        function addOptions(options, key) {
            const container = document.getElementById('chatContainer');
            container.innerHTML += `
                <div class="options-container" id="currentOptions">
                    ${options.map(opt => `<button class="option-btn" onclick="selectOption('${opt}', '${key}')">${opt}</button>`).join('')}
                </div>
            `;
            scrollToBottom();
        }

        // é€‰æ‹©é€‰é¡¹
        function selectOption(value, key) {
            if (value === 'å…¶ä»–') {
                document.getElementById('currentOptions')?.remove();
                document.getElementById('userInput').focus();
                return;
            }
            document.getElementById('currentOptions')?.remove();
            addUserMessage(value);
            answers[key] = value;
            currentQuestionIndex++;
            setTimeout(() => showNextQuestion(), 300);
        }

        // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯
        function addUserMessage(text) {
            const container = document.getElementById('chatContainer');
            container.innerHTML += `<div class="message"><div class="message-user">${text}</div></div>`;
            scrollToBottom();
        }

        // å‘é€æ¶ˆæ¯
        function sendMessage() {
            const input = document.getElementById('userInput');
            const text = input.value.trim();
            if (!text) return;

            const agent = agents[currentAgentIndex];
            const question = agent?.questions[currentQuestionIndex];
            
            addUserMessage(text);
            answers[question?.key || 'extra'] = text;
            input.value = '';
            
            currentQuestionIndex++;
            setTimeout(() => showNextQuestion(), 300);
        }

        // æ›´æ–°Skillsé¢æ¿
        function updateSkillsPanel(skillId) {
            const panel = document.getElementById('skillsPanelContent');
            const skill = typeof SKILLS_DATABASE !== 'undefined' ? SKILLS_DATABASE[skillId] : null;
            
            if (skill) {
                panel.innerHTML += `
                    <div class="skill-card">
                        <div class="skill-card-header">
                            <span class="skill-card-name">${skill.name}</span>
                            <span class="skill-card-book">${skill.book}</span>
                        </div>
                        <div class="skill-card-desc">${skill.description || ''}</div>
                    </div>
                `;
            }
        }

        // åˆ‡æ¢Skillsé¢æ¿
        function toggleSkillsPanel() {
            document.getElementById('skillsPanel').classList.toggle('open');
        }

        // ç”Ÿæˆç»“æœ
        function generateResult() {
            document.getElementById('inputContainer').classList.add('hidden');
            
            addAgentMessage(
                { name: 'âœ¨ ç”Ÿæˆå®Œæˆ', role: 'æ‰€æœ‰æ™ºèƒ½ä½“', emoji: 'âœ¨', color: '#4ade80' },
                'ç»¼åˆ <strong>' + usedSkills.length + ' ä¸ªä¸“ä¸šSkills</strong>ï¼Œä¸ºä½ ç”Ÿæˆäº†ä»¥ä¸‹ Promptï¼š'
            );

            const prompt = buildPrompt();
            showResult(prompt);
        }

        // æ„å»ºPromptï¼ˆä½¿ç”¨SkillsçŸ¥è¯†ï¼‰
        function buildPrompt() {
            const p = answers;
            let prompt = '';
            
            // ä¸»ä½“
            let subject = p.protagonist || 'character';
            if (p.protagonist_feature) subject += `, ${p.protagonist_feature}`;
            if (p.action) subject += `, ${p.action}`;
            if (p.expression) subject += `, ${p.expression} expression`;

            // åœºæ™¯
            let scene = p.location || '';
            if (p.era && !p.era.includes('å…¶ä»–')) scene += `, ${p.era} setting`;

            // é£æ ¼æ˜ å°„ï¼ˆæ¥è‡ªSkillsï¼‰
            const styleMap = {
                'æ—¥ç³»åŠ¨æ¼«': 'anime style, Japanese animation, simplified character detailed background',
                'å‰åœåŠ›é£': 'Studio Ghibli style, hand-painted, warm colors, whimsical',
                'æ–°æµ·è¯šé£': 'Makoto Shinkai style, detailed lighting, lens flare, photorealistic backgrounds',
                'èµ›åšæœ‹å…‹': 'cyberpunk aesthetic, neon lights, futuristic, high tech low life',
                'æ°´å¢¨å›½é£': 'Chinese ink wash painting style, traditional aesthetics, elegant',
                'å†™å®é£æ ¼': 'realistic style, photorealistic, detailed',
                'æš—é»‘å“¥ç‰¹': 'dark gothic style, dramatic shadows, moody'
            };

            // æ°›å›´æ˜ å°„ï¼ˆæ¥è‡ªgurney_atmosphere skillï¼‰
            const atmosphereMap = {
                'æ˜äº®æ¸©æš–': 'warm sunlight, bright atmosphere, direct lighting',
                'æŸ”å’Œæ¢¦å¹»': 'soft dreamy atmosphere, diffused light, ethereal glow',
                'å†·å³»å‡Œå‰': 'cold sharp lighting, high contrast, dramatic',
                'å¤å¤æ€€æ—§': 'nostalgic vintage atmosphere, warm tones, film grain',
                'æ¸…æ–°è‡ªç„¶': 'fresh natural atmosphere, soft lighting',
                'é˜´æš—ç¥ç§˜': 'dark mysterious atmosphere, low key lighting, shadows'
            };

            // é•œå¤´æ˜ å°„ï¼ˆæ¥è‡ªkatz_shot_types skillï¼‰
            const shotMap = {
                'å¤§ç‰¹å†™': 'extreme close-up, detail shot',
                'ç‰¹å†™': 'close-up shot, face',
                'è¿‘æ™¯': 'close-up, head and shoulders',
                'ä¸­æ™¯': 'medium shot, waist up',
                'å…¨æ™¯': 'full body shot',
                'è¿œæ™¯': 'wide shot, environmental'
            };

            // è§’åº¦æ˜ å°„ï¼ˆæ¥è‡ªkatz_camera_angles skillï¼‰
            const angleMap = {
                'å¹³è§†': 'eye level shot',
                'ä»°è§†': 'low angle shot, looking up, powerful',
                'ä¿¯è§†': 'high angle shot, looking down',
                'è·å…°è§’': 'dutch angle, tilted frame, disorienting',
                'é¸Ÿç°': 'bird eye view, overhead shot'
            };

            // è‰²å½©æ˜ å°„ï¼ˆæ¥è‡ªgurney_color_harmony skillï¼‰
            const colorMap = {
                'æš–è‰²è°ƒ': 'warm color palette, red orange yellow tones',
                'å†·è‰²è°ƒ': 'cool color palette, blue green purple tones',
                'äº’è¡¥è‰²å¯¹æ¯”': 'complementary colors, high contrast',
                'ç±»ä¼¼è‰²å’Œè°': 'analogous colors, harmonious',
                'å•è‰²è°ƒ': 'monochromatic color scheme',
                'é«˜é¥±å’Œ': 'vibrant saturated colors',
                'ä½é¥±å’Œ': 'desaturated muted colors, pastel'
            };

            // ç»„è£…
            const style = styleMap[p.art_style] || p.art_style || 'anime style';
            const atmosphere = atmosphereMap[p.atmosphere] || '';
            const shot = shotMap[p.shot_type] || '';
            const angle = angleMap[p.camera_angle] || '';
            const color = colorMap[p.color_scheme] || '';

            if (p.platform === 'Midjourney') {
                prompt = subject;
                if (scene) prompt += `, in ${scene}`;
                prompt += `, ${style}`;
                if (atmosphere) prompt += `, ${atmosphere}`;
                if (color) prompt += `, ${color}`;
                if (shot) prompt += `, ${shot}`;
                if (angle) prompt += `, ${angle}`;
                prompt += `, masterpiece, high quality, detailed --ar 16:9 --v 6`;
            } else if (p.platform === 'Stable Diffusion') {
                prompt = `masterpiece, best quality, ${subject}`;
                if (scene) prompt += `, ${scene}`;
                prompt += `, ${style}`;
                if (atmosphere) prompt += `, ${atmosphere}`;
                if (color) prompt += `, ${color}`;
                if (shot) prompt += `, ${shot}`;
                if (angle) prompt += `, ${angle}`;
                prompt += `\n\nNegative: worst quality, low quality, blurry, bad anatomy, extra limbs, deformed`;
            } else {
                prompt = `${subject}. Scene: ${scene}. Style: ${style}. Atmosphere: ${atmosphere}. Colors: ${color}. Camera: ${shot} ${angle}. High quality, detailed.`;
            }

            return prompt;
        }

        // æ˜¾ç¤ºç»“æœ
        function showResult(prompt) {
            const container = document.getElementById('chatContainer');
            container.innerHTML += `
                <div class="message">
                    <div class="result-box">
                        <div class="result-header">
                            <span class="result-title">ğŸ¯ ${answers.platform || 'Midjourney'} Prompt</span>
                            <button class="copy-btn" onclick="copyPrompt()">ğŸ“‹ å¤åˆ¶</button>
                        </div>
                        <div class="result-content" id="promptResult">${prompt}</div>
                        <div class="skills-used">
                            <div class="skills-used-title">ğŸ“š æœ¬æ¬¡è°ƒç”¨çš„ Skills (${usedSkills.length}ä¸ª)ï¼š</div>
                            <div class="skills-list">
                                ${usedSkills.map(s => `<span class="skill-used">${s}</span>`).join('')}
                            </div>
                        </div>
                    </div>
                    <button class="restart-btn" onclick="restart()">ğŸ”„ é‡æ–°å¼€å§‹</button>
                </div>
            `;
            scrollToBottom();
        }

        function copyPrompt() {
            const text = document.getElementById('promptResult').innerText;
            navigator.clipboard.writeText(text);
            document.querySelector('.copy-btn').textContent = 'âœ… å·²å¤åˆ¶';
        }

        function restart() {
            currentAgentIndex = 0;
            currentQuestionIndex = 0;
            answers = {};
            usedSkills = [];
            document.getElementById('chatContainer').innerHTML = '';
            document.getElementById('inputContainer').classList.remove('hidden');
            document.getElementById('skillsPanelContent').innerHTML = '';
            init();
        }

        function scrollToBottom() {
            const container = document.getElementById('chatContainer');
            container.scrollTop = container.scrollHeight;
        }

        document.getElementById('userInput').addEventListener('keydown', e => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        init();
    </script>
</body>
</html>
