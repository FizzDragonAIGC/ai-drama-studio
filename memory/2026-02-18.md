# 2026-02-18 工作记录

## 系统架构重构（重大更新）

### 6步流程架构（卓卓确认）
1. **小说输入** - 导入小说 OR AI根据需求写小说
2. **高概念分析** - 为后面写长剧本做准备
3. **角色分析** - 人物小传（帮助写章节）+ 人物形象（AI生图基础）
4. **章节规划** - 多少章节，每章多少分钟，镜头密度
5. **服化道** - 角色不同场戏穿不同衣服、拿不同道具
6. **剧本写作** - 一章章写，断了参考前面章节+人物小传续写
7. **分镜生成** - 每章可生成分镜，17列专业格式

### 三栏UI布局
- **左侧**: 项目列表（不同书籍/项目）
- **中间**: 对话窗口（纯对话式）
- **右侧**: 项目资产面板（实时显示）

### 项目资产结构
```javascript
state.assets = {
    concept: {},           // 高概念
    characters: [],        // 角色小传+形象
    chapters: [],          // 章节规划
    costumes: [],          // 服装
    sets: [],              // 场景
    props: [],             // 道具
    scripts: {},           // 剧本（分章存储）
    storyboards: {}        // 分镜（分章存储）
}
```

### 分镜CSV输出格式（17列）
shot_id, 集數, 畫面描述, 場景, 時間, 光線, 氛圍, 角色, 動作, 表情, 服裝, 台詞, 機位, 運鏡, 景別, 敘事功能, Image_Prompt, Video_Prompt

### 镜头密度标准
- 10镜/分钟 = 最低标准
- 15镜/分钟 = 推荐值
- 20+镜/分钟 = 高密度
- AI番剧建议：2-10分钟/集

## Bug修复

### 已修复
1. ✅ showStartOptions状态检查
2. ✅ 服务器隧道修复 (Bug #7)
3. ✅ Skills路径修复 - 改为本地_complete版本
4. ✅ AI写小说功能恢复
5. ✅ 纯对话式访谈（无按钮）
6. ✅ 项目自动创建和保存
7. ✅ 资产面板实时更新

### Skills配置
- 路径: `/ai_drama_studio_v2/workbench/v3/server/skills/`
- 7个_complete合并版:
  - character_complete.skill.md
  - cinematography_complete.skill.md
  - interview_complete.skill.md
  - narrative_complete.skill.md
  - novel_processing_complete.skill.md
  - screenplay_complete.skill.md
  - storyboard_complete.skill.md

## 服务器状态
- 隧道URL: `https://oasis-experimental-toolbox-voltage.trycloudflare.com`
- 后端: localhost:3001 (screen: ai-backend)
- 16 Agents | 6 Skills | DeepSeek Provider

## 对话命令
- `项目资产` - 查看当前项目资产
- `继续` - 继续当前流程
- `生成第X集分镜` - 生成分镜
- `导出剧本` / `导出分镜` / `导出全部` - 导出内容

## 通信频道
- Kuku通信: https://beerbear4369.github.io/kuku-longxia-chat/
- 隧道变化自动更新到该页面

## 关键文件路径
- chat.html: `/home/beerbear/.openclaw/workspace/ai_drama_studio_v2/workbench/v3/chat.html`
- proxy-server.js: `/home/beerbear/.openclaw/workspace/ai_drama_studio_v2/workbench/v3/server/proxy-server.js`
- agents-config.js: `/home/beerbear/.openclaw/workspace/ai_drama_studio_v2/workbench/v3/server/agents-config.js`
- skills目录: `/home/beerbear/.openclaw/workspace/ai_drama_studio_v2/workbench/v3/server/skills/`

## 卓卓确认的设计原则
1. **纯对话式** - 除了导入文件按钮，其他全部通过对话完成
2. **无会员系统** - 所有用户功能一致
3. **项目资产** - 每步骤输出存入资产，右侧面板实时显示
4. **分章存储** - 剧本和分镜按章节存储，方便断点续写
5. **AI番剧 ≠ 无脑短剧** - 3-15分钟/集，有艺术追求
