# 🎨 局部重绘（Inpainting）Skill
> 来源：Stable Diffusion Inpainting最佳实践

---

## 📐 Inpainting概念

| 概念 | 说明 |
|------|------|
| 定义 | 选择性重绘图像局部区域 |
| 原理 | 遮罩区域重新生成，保留其他 |
| 应用 | 修复瑕疵、替换元素、添加细节 |

---

## 🎯 核心参数

### 遮罩设置
| 参数 | 说明 | 建议值 |
|------|------|--------|
| Mask Mode | inpaint/outpaint | 按需选择 |
| Mask Blur | 边缘柔化 | 4-16 |
| Inpaint Area | 重绘范围 | whole/only masked |
| Denoising | 重绘程度 | 0.4-0.9 |

### Denoising强度
| 值 | 效果 | 适用 |
|----|------|------|
| 0.3-0.5 | 轻微修改 | 调整细节 |
| 0.5-0.7 | 中度改变 | 替换元素 |
| 0.7-0.9 | 大幅重绘 | 全新内容 |
| 1.0 | 完全重绘 | 无视原图 |

---

## 🎬 番剧应用场景

### 1. 修复手部
```
【问题】AI生成的手经常畸形

【流程】
1. 遮罩手部区域
2. 提示词：perfect hands, detailed fingers
3. Denoising: 0.5-0.7
4. 多次生成选择最佳
```

### 2. 修改表情
```
【流程】
1. 遮罩面部
2. 提示词添加目标表情
3. Denoising: 0.5-0.6
4. 注意保持肤色一致
```

### 3. 替换背景
```
【流程】
1. 遮罩背景区域
2. 描述新背景
3. Denoising: 0.7-0.9
4. 注意光线方向匹配
```

### 4. 添加道具
```
【流程】
1. 遮罩道具位置
2. 描述要添加的物品
3. Denoising: 0.8-1.0
4. 注意透视和比例
```

---

## 📋 遮罩技巧

### 绘制原则
```
【边界处理】
- 遮罩略大于目标区域
- 使用Mask Blur柔化边缘
- 避免尖锐边界

【精确遮罩】
- 使用外部工具（PS、GIMP）
- 导入alpha通道遮罩
- 使用分割模型辅助
```

### 分层遮罩策略
```
复杂修改分多次：
1. 先修复大结构
2. 再调整小细节
3. 最后统一色调
```

---

## 🔧 模式详解

### Inpaint Masked
```
重绘遮罩覆盖的区域
保留其他区域
适用：修改特定部分
```

### Inpaint Not Masked
```
保留遮罩覆盖的区域
重绘其他区域
适用：保留主体，换背景
```

### Fill vs Original
```
Fill：用颜色填充再生成
Original：保留原内容参考

Fill适合：完全替换
Original适合：微调修改
```

---

## 🎨 提示词技巧

### 局部重绘提示词
```
【结构】
[要生成的内容] + [质量词] + [风格词]

【示例】
修手：perfect detailed hands, anatomically correct
修脸：beautiful detailed face, correct proportions
加物：[物品名], detailed, high quality
```

### 负面提示词
```
常用：
blurry, distorted, deformed,
bad anatomy, extra limbs,
inconsistent lighting
```

---

## ⚡ 工作流优化

### 批量修复流程
```
1. 识别所有问题区域
2. 分类（手部/面部/其他）
3. 准备对应提示词模板
4. 批量处理同类问题
5. 最后统一检查
```

### 质量检查清单
| 检查项 | ✓ |
|--------|---|
| 边缘融合自然 | □ |
| 光线方向一致 | □ |
| 色调匹配 | □ |
| 比例正确 | □ |
| 风格统一 | □ |

---

## 💡 高级技巧

### ControlNet辅助
```
用ControlNet引导重绘：
- OpenPose：控制手部姿势
- Depth：保持空间关系
- Lineart：保持轮廓
```

### 多次低强度
```
不满意时：
不用一次高强度，
而是多次低强度迭代，
效果更自然
```

### 参考图引导
```
使用img2img配合inpaint
参考图控制整体风格
遮罩控制修改区域
```

---

## ⚠️ 常见问题

| 问题 | 解决 |
|------|------|
| 边缘明显 | 增加Mask Blur |
| 风格不统一 | 保持相同模型和参数 |
| 光线不匹配 | 描述正确光线方向 |
| 反复失败 | 扩大遮罩范围 |

---

*Skill版本: 1.0*
*适用: Stable Diffusion WebUI/ComfyUI*
*创建时间: 2026-02-14*
