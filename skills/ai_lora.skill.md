# 🧬 LoRA训练详解 Skill
> 来源：LoRA论文 + Kohya训练器实践

---

## 📐 LoRA基础概念

| 概念 | 说明 |
|------|------|
| 全称 | Low-Rank Adaptation |
| 原理 | 低秩矩阵微调神经网络 |
| 优势 | 小体积、快训练、易叠加 |
| 文件大小 | 通常10-200MB |

---

## 🎯 LoRA类型

| 类型 | 用途 | 训练素材 |
|------|------|----------|
| 角色LoRA | 固定角色外观 | 角色多角度图 |
| 风格LoRA | 特定画风 | 风格统一的图集 |
| 概念LoRA | 物品/场景 | 概念相关图片 |
| 姿势LoRA | 特定姿态 | 同姿势多图 |

---

## 📋 训练数据准备

### 图片要求
| 项目 | 要求 |
|------|------|
| 数量 | 角色15-50张，风格50-200张 |
| 分辨率 | 512x512或1024x1024 |
| 质量 | 清晰、无水印 |
| 多样性 | 不同角度、光线、表情 |

### 标注方法
```
【自动标注】
使用BLIP/DeepBooru自动生成

【手动标注】
每张图配txt文件，描述内容
保持格式统一

【标签格式示例】
1girl, long pink hair, green eyes, 
red dress, standing, smile, 
looking at viewer, detailed
```

### 触发词设计
```
【角色触发词】
独特的触发词：sakura_char
使用时：sakura_char, 1girl, ...

【风格触发词】
ghibli_style, anime artwork, ...
```

---

## 🔧 Kohya训练参数

### 基础设置
```yaml
# 模型相关
pretrained_model: sd_xl_base_1.0.safetensors
output_name: my_character_lora

# 训练参数
train_batch_size: 1
num_epochs: 10
learning_rate: 0.0001
lr_scheduler: cosine
optimizer: AdamW8bit

# LoRA参数
network_dim: 32      # 8-128，越大越精细
network_alpha: 16    # 通常为dim的一半
```

### 推荐配置
| 用途 | dim | alpha | 学习率 |
|------|-----|-------|--------|
| 角色（轻量） | 16 | 8 | 1e-4 |
| 角色（标准） | 32 | 16 | 1e-4 |
| 风格 | 64 | 32 | 5e-5 |
| 概念 | 32 | 16 | 1e-4 |

---

## 🎬 番剧角色LoRA流程

### 1. 素材收集
```
【来源】
- 已有角色设计图
- AI生成的角色图（需一致）
- 手绘稿

【收集要点】
- 正面、侧面、背面、3/4角度
- 不同表情
- 不同姿势
- 保持服装、发型一致
```

### 2. 数据处理
```
【裁剪】
确保角色居中，适当留白

【标注】
保持固定格式：
trigger_word, 1girl/1boy, 
[发型发色], [眼睛颜色], [服装],
[姿势], [表情], [背景]
```

### 3. 训练
```
【快速测试】
5-10 epochs，观察效果

【正式训练】
10-20 epochs
每隔几个epoch保存检查点
选择最佳版本
```

### 4. 测试验证
```
【测试提示词】
trigger_word, 1girl,
[新的姿势], [新的场景],
high quality, detailed

【验证点】
- 面部特征是否一致
- 服装细节是否保留
- 是否过拟合
```

---

## 📊 训练监控

### Loss曲线
```
正常：平稳下降，最终趋于稳定
过拟合：下降后上升
欠拟合：始终较高
```

### 检查点选择
| epoch | 适用情况 |
|-------|----------|
| 早期 | 欠拟合，泛化好 |
| 中期 | 通常最佳平衡 |
| 晚期 | 可能过拟合 |

---

## ⚡ 使用LoRA

### 加载方式
```
WebUI: 在Extra Networks选择
ComfyUI: 使用Load LoRA节点
```

### 权重调整
| 权重 | 效果 |
|------|------|
| 0.3-0.5 | 轻度影响 |
| 0.6-0.8 | 标准效果 |
| 0.9-1.2 | 强效果，可能过强 |

### 多LoRA叠加
```
角色LoRA(0.8) + 风格LoRA(0.5)
总权重建议不超过1.5
注意兼容性
```

---

## ⚠️ 常见问题

| 问题 | 原因 | 解决 |
|------|------|------|
| 不像原角色 | 数据不足/标注差 | 增加数据、优化标注 |
| 过拟合 | 训练过度 | 减少epoch、增加数据 |
| 泛化差 | 数据单一 | 增加多样性 |
| 与其他LoRA冲突 | 训练域重叠 | 调整权重 |

---

## 💡 高级技巧

### 正则化
```
使用类别图片防止过拟合
例：训练角色时加入通用人物图
```

### 分层训练
```
只训练特定层
减少训练时间
针对性调整
```

---

*Skill版本: 1.0*
*适用: Stable Diffusion / SDXL*
*创建时间: 2026-02-14*
