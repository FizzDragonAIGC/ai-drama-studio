# 智能章節分配系統 (Smart Chapter Allocation)

## 概述
基於故事長度、內容密度、情節節點，智能計算最佳的集數和每集時長配置。當用戶指定的配置不合理時，給出專業建議。

## 核心公式

### 基礎換算
- **1000字原文 ≈ 2-3分鐘成品**（取決於對話/動作比例）
- **對話密集型**：1000字 ≈ 2分鐘
- **動作/描寫密集型**：1000字 ≈ 3-4分鐘
- **心理獨白型**：1000字 ≈ 1.5分鐘

### 每集時長建議
| 類型 | 建議時長 | 適合 |
|------|----------|------|
| 泡面番 | 3-5分鐘 | 日常喜劇、輕鬆小品 |
| 標準番 | 8-12分鐘 | 大多數故事 |
| 電影感 | 15-25分鐘 | 史詩、懸疑、情感深度 |

### 集數計算
```
總時長 = 字數 × 換算係數
建議集數 = 總時長 ÷ 每集時長
調整因素 = 情節轉折點數量
```

---

## 智能分析流程

### Step 1: 故事掃描
1. 計算總字數
2. 識別文體類型（對話型/動作型/心理型）
3. 提取所有情節轉折點（自然分集點）
4. 識別高潮場景位置

### Step 2: 分配評估
根據用戶指定的「集數×每集時長」計算：
```
用戶總時長 = 集數 × 每集時長
故事自然時長 = 字數 × 換算係數
匹配度 = 用戶總時長 / 故事自然時長
```

### Step 3: 匹配度判斷
| 匹配度 | 判斷 | 建議 |
|--------|------|------|
| 0.7-1.3 | ✅ 合理 | 微調即可 |
| 0.5-0.7 | ⚠️ 偏緊 | 需要刪減情節 |
| 1.3-1.6 | ⚠️ 偏鬆 | 可能節奏拖沓 |
| <0.5 | ❌ 過短 | 必須大幅刪減 |
| >1.6 | ❌ 過長 | 考慮增加集數或原創內容 |

---

## 專業建議模板

### 當故事太長（需要刪減）
```
📊 分析結果：故事約需 {自然時長} 分鐘，但您設定 {集數}集×{時長}分鐘 = {總時長}分鐘

⚠️ 差距：超出 {超出百分比}%

🔪 建議刪減方案：
1. 【可刪】{支線名} - 約省{X}分鐘 - 原因：對主線影響小
2. 【可簡】{場景名} - 約省{X}分鐘 - 原因：可用快速剪輯帶過
3. 【可合併】{角色A}和{角色B} - 約省{X}分鐘 - 原因：功能重疊

📌 不可刪：
- {核心衝突場景} - 主線關鍵
- {角色轉變場景} - 人物弧光必需
```

### 當故事太短（需要擴充）
```
📊 分析結果：故事約需 {自然時長} 分鐘，但您設定 {集數}集×{時長}分鐘 = {總時長}分鐘

⚠️ 差距：不足 {不足百分比}%

✍️ 建議擴充方案：
1. 【可展開】{場景名} - 可加{X}分鐘 - 建議：增加角色互動細節
2. 【可新增】{位置}處插入回憶 - 可加{X}分鐘 - 建議：深化角色背景
3. 【可視覺化】{心理描寫} - 可加{X}分鐘 - 建議：轉化為意象畫面

🎯 或者調整配置：
- 方案A：減少到 {建議集數} 集
- 方案B：每集縮短到 {建議時長} 分鐘
```

---

## 分集點識別規則

### 自然分集點（優先選擇）
1. **時間跳躍** - "三天後"、"次日清晨"
2. **空間轉換** - 場景從A地到B地
3. **衝突升級** - 新的障礙出現
4. **揭示時刻** - 秘密被發現
5. **決定時刻** - 角色做出重要選擇

### 鉤子設計要求
每集結尾必須有以下之一：
- **懸念鉤**：未解決的問題
- **情感鉤**：強烈情緒高點
- **反轉鉤**：意外發現
- **威脅鉤**：即將到來的危險

---

## 輸出格式

```json
{
  "analysis": {
    "total_words": 50000,
    "content_type": "對話型",
    "conversion_rate": 2.5,
    "natural_duration": 125,
    "turning_points": 12
  },
  "user_config": {
    "episodes": 10,
    "duration_per_episode": 10,
    "total_duration": 100
  },
  "match_score": 0.8,
  "verdict": "偏緊但可行",
  "recommendations": {
    "cuts": [
      {"name": "支線A", "save_minutes": 5, "priority": "建議刪"},
      {"name": "場景B", "save_minutes": 3, "priority": "可簡化"}
    ],
    "must_keep": ["主線衝突場景", "角色轉變場景"],
    "alternative_configs": [
      {"episodes": 12, "duration": 10, "reason": "更從容展開"},
      {"episodes": 10, "duration": 12, "reason": "保留完整情節"}
    ]
  },
  "episode_plan": [
    {
      "episode": 1,
      "title": "建議標題",
      "duration": 10,
      "content_summary": "涵蓋原著第X-Y章",
      "end_hook": "懸念類型和內容",
      "key_scenes": ["場景1", "場景2"]
    }
  ]
}
```

---

## 實戰案例

### 案例：5萬字武俠小說
- **自然時長**：125分鐘
- **用戶設定**：8集×10分鐘 = 80分鐘
- **匹配度**：0.64（偏緊）

**建議**：
1. 刪除「青樓戲份」- 省15分鐘
2. 簡化「練功過程」- 省10分鐘
3. 合併「師兄弟二人」為一人 - 省10分鐘
4. 或改為10集×10分鐘

### 案例：2萬字短篇
- **自然時長**：50分鐘
- **用戶設定**：10集×10分鐘 = 100分鐘
- **匹配度**：2.0（過長）

**建議**：
1. 減少到5集
2. 或每集縮短到5分鐘
3. 如堅持10集，需大量原創擴充

---

## 檢查清單
- [ ] 計算故事自然時長
- [ ] 識別所有自然分集點
- [ ] 評估用戶配置匹配度
- [ ] 給出具體刪減/擴充建議
- [ ] 標註不可動的核心場景
- [ ] 提供替代配置方案
- [ ] 每集都有鉤子設計
